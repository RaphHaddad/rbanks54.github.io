---
layout: post
title: How to get Git and TFS Working Together
date: '2010-01-27T15:14:00.002+11:00'
author: Richard Banks
tags:
- how to
- open source
- TFS
modified_time: '2010-04-06T07:51:21.254+10:00'
thumbnail: http://lh5.ggpht.com/_5dD_rBQSs2o/S1-9u156_5I/AAAAAAAAAsY/VpzmN6opH8U/s72-c/image_thumb.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-8319877222791212330
blogger_orig_url: http://www.richard-banks.org/2010/01/how-to-get-git-and-tfs-working-together.html
---

<p><i>Update: There's now a <a href="http://richardsbraindump.blogspot.com/2010/04/git-tfs-working-together-version-2.html">second approach</a> for doing this that you may want to look at</i></p><p>TFS has a lot going for it and from a team perspective it’s a fantastic tool and something I wouldn’t pass up willingly.&#160; That said it is a little lacking in some areas and one of those is the source control story.&#160; For some time now I’ve been toying with writing a Git-TFS bridge but just haven’t had the time to really get stuck into it.&#160; For that reason I decided to see if I can get Git talking to TFS via the TFS SvnBridge utility.&#160; I know what you’re thinking and yes, it’s a 3-headed monster if ever I’ve seen one, but I’m a brave (or foolhardy) adventurer and I don’t mind the occasional challenge.</p>  <p>As a note I’m not going to go into a lot of detail on some of the Git commands.&#160; This is more about how to get Git and TFS working together, not how to use Git.</p>  <h3>Getting started</h3>  <p>Download the SvnBridge client from <a title="http://svnbridge.codeplex.com/" href="http://svnbridge.codeplex.com/">http://svnbridge.codeplex.com/</a>.&#160; Extract the SvnBridge.exe from the zip file and run it.&#160; It will appear in your system tray and will show you the base URL to use for your SVN commands when you mouse over it.</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/S1-9ue9ThSI/AAAAAAAAAsU/PSXWGtyByRk/s1600-h/image%5B2%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/S1-9u156_5I/AAAAAAAAAsY/VpzmN6opH8U/image_thumb.png?imgmax=800" width="165" height="73" /></a> </p>  <p>To make sure it’s all working try browsing the TFS server via <a href="http://tortoisesvn.tigris.org/" target="_blank">TortoiseSVN</a> (repo-browser). I found this to be a little slow, but it worked fine.&#160; The URL I used in SVN was something like this <a title="http://localhost:8080/dp0002tf0001.devpod2.com/hopout/Trunk" href="http://localhost:8080/tfs.server.name/projectName/Trunk">http://localhost:8080/tfs.server.name/projectName/Trunk</a></p>  <p>Assuming that’s OK you can then create an empty folder, open a command prompt and set the new folder as your current directory. Now you can clone (i.e. copy) the TFS repository into Git using the command below (as a note I use <a href="http://code.google.com/p/msysgit/" target="_blank">msysgit</a> for my git work and have the git bin folder in my path).</p>  <p><em>git svn clone </em><a title="http://localhost:8080/dp0002tf0001.devpod2.com/hopout/Trunk" href="http://localhost:8080/tfs.server.name/projectName/Trunk/SubFolder"><em>http://localhost:8080/tfs.server.name/projectName/Trunk/SubFolder</em></a><em> SubFolder</em></p>  <p>This admittedly did take quite a while to do.&#160; It was a large source tree and the TFS server is in a remote location but even so, it’s a lot slower than just doing a full get latest from TFS.&#160; Also, be aware that cloning a repository is making a copy of the whole repository, <em>including history.</em> If you just want the latest revisions and you’re not worried about history (it’s in TFS after all) then I’d recommend you use the –r option and supply a recent changeset number (or range).</p>  <p>I also noticed that failing to put the target folder name at the end (even when it’s the same) can result in errors like this so make sure you include it.</p>  <p><em>Invalid filesystem path syntax: REPORT request failed on '/tfs.server/!svn/vcc/default': Target path does not exist at c:\Program Files (x86)\Git/libexec/git-core/git-svn line 4567</em></p>  <p>Now go get a coffee and come back.&#160; Once the download completes you should be able to browse your source folder and see everything is there.</p>  <h3>We’re all set now, right?</h3>  <p>OK, so now we have all the files from TFS locally, and because we used the SvnBridge we don’t have the annoying TFS read-only flag set on our files.&#160; Nice.&#160; We can start working on our project again, right?</p>  <p>Well not quite.&#160; Visual Studio has this nasty “feature” where it puts source control binding information into the solution and project files.&#160; It’s a major pain in the butt and is something you’ll have to work around if you’re in a team environment where not everyone is using this Git/Svn/TFS combo.&#160; We’ll need to manually remove all that binding information from the solution, however we have to think of our team members.&#160; We can’t just edit the solution file directly as other TFS users will/may be relying on it.</p>  <p>Also, before we make this change we’re going to do one other thing.&#160; We’re going to create a local branch and use that as our working folder.</p>  <p>You can either use the Git Gui (see the branch menu) or you can do it via the command line using the <em>git branch</em> or <em>git checkout –b NewBranch </em>commands.&#160; I’ll leave it up to you to choose the method you prefer.</p>  <p>So now we should have both a master and a local branch. Before we proceed just confirm that you are in the correct branch by doing a <em>git branch</em> command (no arguments) at the command line – the current branch should be highlighted.&#160; If you’re using the GUI then the branch name is shown near the top.</p>  <p>Now, to remove the bindings open the solution file in <a href="http://notepad-plus.sourceforge.net/uk/site.htm" target="_blank">notepad++</a> (or the text editor of your choice) and find the section that looks like this and simply remove it.</p>  <p>GlobalSection(TeamFoundationVersionControl) = preSolution   <br />&#160;&#160;&#160; SccNumberOfProjects = 15    <br />&#160;&#160;&#160; SccEnterpriseProvider = {4CA534B2-18FA-4F9D-95D4-32DDF27D184C}    <br />&#160;&#160;&#160; SccTeamFoundationServer = <a href="http://tfs.server:8080/">http://tfs.server:8080/</a>    <br />&#160;&#160;&#160; SccLocalPath0 = .    <br />EndGlobalSection</p>  <p>Save the file and then open it with Visual Studio.&#160; When you do, you’ll be told that the source control provider can’t be installed and then presented with a choice.</p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/S1-9vVYNSzI/AAAAAAAAAsc/1piP3x1zHFw/s1600-h/image%5B12%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/S1-9wGgyg3I/AAAAAAAAAsg/XMxJ98L-OrY/image_thumb%5B6%5D.png?imgmax=800" width="404" height="201" /></a> </p>  <p>Since you’re in your local branch you can take either option.&#160; I prefer to choose to work uncontrolled so that visual studio doesn’t remove all the source bindings from the project files (which would break things for others on the team) and it means there’s one less thing to worry about when pushing changes back to TFS.&#160; Regardless, once you make a choice the solution will open as expected and you can make the changes you need to.</p>  <p>P.S. If you haven’t already done so, you may want to create a .gitignore file to ignore those pesky artefacts that get created during development.&#160; There’s an example of one here - <a title="http://gist.github.com/233903" href="http://gist.github.com/233903">http://gist.github.com/233903</a>.&#160; Just put it in the root of your source tree (the folder with the .git subfolder).&#160; You may also want to commit it to your repository so you can track any changes.</p>  <h3>Now we’re cooking! Let’s update TFS!</h3>  <p>OK so now we’re all set.&#160; Sweet! Go ahead and do your normal development work.&#160; It’s OK.&#160; You’re allowed to :-)</p>  <p>When you’ve made changes you can commit them to Git using either the command line or the Git Gui (which I tend to use) and do any of the other normal things you would do when using Git.</p>  <p>When you’re ready we can now push your changes up to the TFS server.&#160; First we’ll want to push our local branch changes to the master branch (remember to be aware of changes in the solution file).&#160; You may also want to do a <em>git rebase</em> (<a href="http://www.gitready.com/advanced/2009/02/10/squashing-commits-with-rebase.html" target="_blank">example</a>) on your local branch to consolidate all your small changes into a single commit before merging to master in preparation for pushing to TFS.</p>  <p>The workflow is basically: git rebase (optional) –&gt; git checkout master&#160; –&gt; git merge –&gt; push to TFS</p>  <p>And the command to commit to TFS is simply</p>  <p><em>git svn dcommit</em></p>  <p>Git will push all your local changes to the server and if everything is OK you should be able to switch to team explorer and see the changes in there.&#160; Nice :-)</p>  <h3>How do I do a “Get Latest”?</h3>  <p>I almost forgot, you will no doubt want to do a “get latest” at some point.&#160; From the command prompt simply do this:</p>  <p><em>git svn fetch</em></p>  <p>And it will get the latest changes for you and update your local git repository.&#160; Note that git won’t just get the latest change, it will actually get all the individual changesets from TFS so that the local Git history is up to date.&#160; This is slightly different from TFS where the local workspace is just being brought up to the current changeset.</p>  <h3>Pros and Cons?</h3>  <p>So, what are the benefits and where do things fall over?</p>  <p>Well, obviously the biggest benefit is that you are now able to use git and work in a truly offline manner from TFS.&#160; You can branch locally and make changes in isolation of others without messing things up for anyone other than yourself, and the speed when working locally is blindingly fast (no over the wire communication with TFS)</p>  <p>On the downside SvnBridge is quite slow and the process to get code in and out of TFS involves more steps than clicking a few buttons in Visual Studio.&#160; </p>  <p>Also, with Git holding all the history, you’ll chew up quite a bit more disk space locally.&#160; I know disk is cheap but in many organisations developers are forced to work with puny boxes and miniscule amounts of space so it may be an issue.</p>  <p>Caveat Emptor:&#160; I haven’t done a lot of work this way as yet and there are many things I haven’t come across as yet (check in policies blocking a commit for instance) so your mileage may vary. You have been warned :-) </p>  <p>If you do try this, I’d be keen to hear how you get along with it.&#160; Good luck!</p>