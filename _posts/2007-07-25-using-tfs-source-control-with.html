---
layout: post
title: Using TFS Source Control with CruiseControl.NET
date: '2007-07-25T08:48:00.001+10:00'
author: Richard Banks
tags:
- readify
- TFS
- CruiseControl.NET
modified_time: '2007-07-25T21:30:22.429+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-4806291271673676543
blogger_orig_url: http://www.richard-banks.org/2007/07/using-tfs-source-control-with.html
---

<p>Microsoft finally delivered a decent source control with the release of Team Foundation Server giving the thousands of development teams still using SourceSafe a way to move forward.</p><p>But what do you do it you've got <a href="http://ccnet.thoughtworks.com/" target="_blank">CruiseControl.NET</a> running against a VSS repository.  Thankfully there is a way to hook CruiseControl.NET into a TFS source repository and it's fairly straightforward as well.</p><p>Instead of using the VSS source control block in your ccnet.config file, simply change to the VSTS source control block.</p><p>Here's what you'll need to do</p><p>1. Download the <a href="http://www.codeplex.com/TFSCCNetPlugin/Release/ProjectReleases.aspx?ReleaseId=800" target="_blank">TFS Plugin for CCNet</a> from CodePlex</p><p>2. Change your source control block in ccnet.config to look something like the following:</p><p><pre class="codeblock"><span style="COLOR: rgb(0,0,255)">    &lt;</span><span style="COLOR: rgb(163,21,21)">sourcecontrol</span><span style="COLOR: rgb(0,0,255)"> </span><span style="COLOR: rgb(255,0,0)">type</span><span style="COLOR: rgb(0,0,255)">=</span>"<span style="COLOR: rgb(0,0,255)">vsts</span>"<span style="COLOR: rgb(0,0,255)"> </span><span style="COLOR: rgb(255,0,0)">autoGetSource</span><span style="COLOR: rgb(0,0,255)">=</span>"<span style="COLOR: rgb(0,0,255)">true</span>"<span style="COLOR: rgb(0,0,255)"> </span><span style="COLOR: rgb(255,0,0)">applyLabel</span><span style="COLOR: rgb(0,0,255)">=</span>"<span style="COLOR: rgb(0,0,255)">false</span>"<span style="COLOR: rgb(0,0,255)">&gt;<br />      &lt;</span><span style="COLOR: rgb(163,21,21)">server</span><span style="COLOR: rgb(0,0,255)">&gt;</span>http://TFSServer:8080<span style="COLOR: rgb(0,0,255)">&lt;/</span><span style="COLOR: rgb(163,21,21)">server</span><span style="COLOR: rgb(0,0,255)">&gt;<br />      &lt;</span><span style="COLOR: rgb(163,21,21)">project</span><span style="COLOR: rgb(0,0,255)">&gt;</span>$/MyProject/<span style="COLOR: rgb(0,0,255)">&lt;/</span><span style="COLOR: rgb(163,21,21)">project</span><span style="COLOR: rgb(0,0,255)">&gt;<br />      &lt;</span><span style="COLOR: rgb(163,21,21)">workingDirectory</span><span style="COLOR: rgb(0,0,255)">&gt;</span>c:\Projects\<span style="COLOR: rgb(0,0,255)">&lt;/</span><span style="COLOR: rgb(163,21,21)">workingDirectory</span><span style="COLOR: rgb(0,0,255)">&gt;<br />      &lt;</span><span style="COLOR: rgb(163,21,21)">cleanCopy</span><span style="COLOR: rgb(0,0,255)">&gt;</span>false<span style="COLOR: rgb(0,0,255)">&lt;/</span><span style="COLOR: rgb(163,21,21)">cleanCopy</span><span style="COLOR: rgb(0,0,255)">&gt;<br />      &lt;</span><span style="COLOR: rgb(163,21,21)">workspace</span><span style="COLOR: rgb(0,0,255)">&gt;</span>CCNET_MyProject<span style="COLOR: rgb(0,0,255)">&lt;/</span><span style="COLOR: rgb(163,21,21)">workspace</span><span style="COLOR: rgb(0,0,255)">&gt; </span><br />    &lt;/</span><span style="COLOR: rgb(163,21,21)">sourcecontrol</span><span style="COLOR: rgb(0,0,255)">&gt;</span></pre><p></p><p>3. Save ccnet.config and you're done :-)</p><p>So, what actually happens here?.</p><ul><br /><li>Firstly, we use the &lt;server /&gt; tag to define the location of the TFS server where we will get our source from.</li><br /><li>Next we define which location in source control the code will be retrieved from using the &lt;project /&gt; tag.  We also define where we will place the source on the build server using the &lt;workingDirectory /&gt; tag. Even though the CC.NET web site indicates that the workingDirectory tag is optional, I've found that it won't work without it.</li><br /><li>We also define the workspace name to use when retrieving the source.  If this isn't specified the server uses the name CCNET, however if you have multiple projects on your build server you will get name conflicts.  It's better to specify a workspace name to avoid headaches.</li><br /><li>Finally, the &lt;cleanCopy /&gt; tag is used to tell CCNet to only update files.  If you want to re-get everything from source control each time, then you need to change this value to true.</li></ul><br /><p>The eagle-eyed among you may also note that we haven't specified the account to connect to TFS with.  By default this will be the account that the CC.Net server runs under.  If this is not the account you wish to connect to TFS with you can specify the user account (and password) to use, but having a user account and password in clear text in a config file is not a great security practice. </p><br /><p>For more information have a look at the <a href="http://confluence.public.thoughtworks.org/x/zRE">reference information.</a></p><p> </p><p>A tip for first time players:</p><br /><p>One of the things people do when setting up their server for the first time or when changing ccnet.config files is to run ccnet manually and then, after it's all working, start it as a service.  In some situatuions you may find that after starting the service you have a workspace conflict error when trying to get source code from TFS.  This can happen when the account you run the manual service under is different than the ccnet service account.  If it does happen all you should need to do is delete the workspaces you created using Team Explorer.  The VSTS plug in will recreate the workspaces the next time it queries the repository.</p>