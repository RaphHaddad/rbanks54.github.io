---
layout: post
title: Living with Team Foundation Server Version Control
date: '2007-12-07T15:24:00.001+11:00'
author: Richard Banks
tags:
- readify
- TFS
modified_time: '2007-12-07T19:09:40.226+11:00'
thumbnail: http://lh6.google.com/rbanks54/R1jK6RtQjEI/AAAAAAAAANI/sa07h2Tl4J0/s72-c/clip3_thumb%5B1%5D
blogger_id: tag:blogger.com,1999:blog-13321238.post-4472830741470909178
blogger_orig_url: http://www.richard-banks.org/2007/12/living-with-team-foundation-server.html
---

<p>Recently I wrote up a short overview on how TFS source control works for a client.  I've reproduced it here as it may hopefully help you understand how TFS works and reduce the number of “wierdnesses” that people experience when using TFS. <p>For most people the normal behaviour when doing a “Get Latest” is one drilled into us through years of Source Safe (ab)use.  Right click the solution file, and select Get Latest Version (Recursive) as shown here: <p><a href="http://lh3.google.com/rbanks54/R1jK5htQjDI/AAAAAAAAANA/2A-2sFn98bc/clip3%5B3%5D"><img style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" height="479" alt="clip3" src="http://lh6.google.com/rbanks54/R1jK6RtQjEI/AAAAAAAAANI/sa07h2Tl4J0/clip3_thumb%5B1%5D" width="341" border="0" /></a> <p>However with TFS we really should be doing it like this (via the Source Control Explorer): <p><a href="http://lh4.google.com/rbanks54/R1jK6xtQjFI/AAAAAAAAANQ/jANVmC5m6cU/clip4%5B3%5D"><img style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" height="376" alt="clip4" src="http://lh3.google.com/rbanks54/R1jK7htQjGI/AAAAAAAAANY/rTVgo-oMpWM/clip4_thumb%5B1%5D" width="359" border="0" /></a> <p>Experienced TFS users will also typically use "Get Specific Version" with the Force Get option turned on.  <p>Similarly when doing a check in through the Visual Studio UI (which is 99.99% of the time) it’s good practice to ALWAYS click the refresh button first to make sure you’re list of pending changes is accurate. <p><a href="http://lh5.google.com/rbanks54/R1jK8BtQjHI/AAAAAAAAANg/pM0j7yTxjFs/clip5%5B3%5D"><img style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" height="70" alt="clip5" src="http://lh4.google.com/rbanks54/R1jK8xtQjII/AAAAAAAAANo/QKlOP9l0xwQ/clip5_thumb%5B1%5D" width="780" border="0" /></a> <p>Why, though? <h4>Problem 2 First</h4><p>Let’s tackle the second issue (the refresh button) first.  When files are changed in Visual Studio an event is raised indicating that the file has been checked out in source control and that it should be treated as a pending change.  At various times those events don’t get picked up by the pending changes window in VS which will in turn means that the UI doesn’t refresh automatically.  This can then result in a check in that misses required files, simply because the UI didn’t show them.  (See this <a href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=618316&amp;SiteID=1">forum entry</a> for background info) <p>By clicking the refresh button, the UI will re-query the status of the files in the workspace and give you the full list of files available for check in. <p>Note that it doesn’t ask the TFS server for the status of the files, just the workspace.  Also if you have made changes outside of visual studio, or performed offline changes you’ll need to do a refresh of the pending status for all files in the workspace using the team foundation power tool (tfpt). <h4>Other Gotcha's</h4><p>There are other situations where you change a file but it doesn't show as being any different to the latest version in TFS.  This is particularly noticeable with solution files and occurs because Visual Studio keeps the solution file in memory and doesn't write out the change unit you have saved it to disk. <p>There is also an issue with files that are writeable but not checked out.  If you edit one of these writeable files in  Visual Studio then VS assumes that the file is already checked out and will <strong>not </strong>check the file out of source control automatically if you start to edit it.  This typically happens when editing files offline, or when using a third party program that overrides the readonly flag. <h4>Understanding Workspaces et al</h4><p>Now back to the first problem.  Why should we do a get latest from Source Control Explorer instead of the solution file?  The answer relates to the way in which TFS is designed. <p>Firstly,  TFS Version Control uses the concept of workspaces to track file statuses.  A workspace is TFS’s view of what files the server thinks you have on your local machine in a specified path (the local folder as shown here) and is treated as a snapshot of the source repository at a given point in time: <p><a href="http://lh3.google.com/rbanks54/R1jK9htQjJI/AAAAAAAAANw/4ftIAf20rpg/clip6%5B3%5D"><img style="BORDER-TOP-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-RIGHT-WIDTH: 0px" height="429" alt="clip6" src="http://lh6.google.com/rbanks54/R1jK-RtQjKI/AAAAAAAAAN4/CNqPlx9VLsw/clip6_thumb%5B1%5D" width="629" border="0" /></a> <p>This way, when you do a get latest, TFS will only send you the updates it thinks you need, based on the changes made since you last updated your workspace.  This is meant to help reduce network traffic and improve performance. <p>The other thing to understand is that TFS treats a workspace as a snapshot of the source repository and therefore each changeset is an atomic change to a know set of files.  It expects that all files in a workspace are as at the same point in time. <p>In fact, this is the reason why doing a checkout of a single file only marks it as editable and doesn’t perform a get latest.  Buck Hodges <a href="http://blogs.msdn.com/buckh/archive/2005/08/20/454140.aspx">blog entry</a> explains it better (emphasis mine): <p><strong>Why doesn't Team Foundation get the latest version of a file on checkout?</strong> <blockquote><p><span style="color:#000066;">I've seen this question come up a few times.  Doug Neumann, our PM, wrote a nice explanation in the Team Foundation forum (</span><a href="http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=70231"><span style="color:#000066;">http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=70231</span></a><span style="color:#000066;">). </span><p><span style="color:#000066;">It turns out that this is by design, so let me explain the reasoning behind it.  When you perform a get operation to populate your workspace with a set of files, you are setting yourself up with a consistent snapshot from source control.  Typically, the configuration of source on your system represents a point in time snapshot of files from the repository that are known to work together, and therefore is buildable and testable. </span><p><span style="color:#000066;">As a developer working in a workspace, you are isolated from the changes being made by other developers.  You control when you want to accept changes from other developers by performing a get operation as appropriate.  <b>Ideally when you do this, you'll update the entire configuration of source, and not just one or two files.  Why?  Because changes in one file typically depend on corresponding changes to other files, and you need to ensure that you've still got a consistent snapshot of source that is buildable and testable</b>. </span><p><span style="color:#000066;">This is why the checkout operation doesn't perform a get latest on the files being checked out.  <b>Updating that one file being checked out would violate the consistent snapshot philosophy</b> and could result in a configuration of source that isn't buildable and testable.  As an alternative, Team Foundation forces users to perform the get latest operation at some point before they checkin their changes.  That's why if you attempt to checkin your changes, and you don't have the latest copy, you'll be prompted with the resolve conflicts dialog.</span></p></blockquote><p><p>If you do a get latest in Visual Studio by right clicking the solution file, Visual Studio gets the current list of files references by the solution and requests the latest version of each of those files.  It doesn’t do a get latest for the entire workspace.  Why?  Because Visual Studio is designed to work with a source control provider and not all source control systems work like TFS. <p>Since files are retrieved individually it also helps explain why a new project added to a solution sometimes won’t appear straight away and why you have to manually do another get latest to get it – and why you may have to do a “force update” as well. <p>If however you use SCE to do the “get latest” (and you do it from the workspace root) then you are updating your local code base with the entire snapshot, not individual files.  In the case of a new project being added, your “get latest” would have retrieved the new solution file AND the new project’s source files, so when the solution reloads all the files will be present and you won’t be missing anything. <p>Hopefully this makes sense, but if not, please let me know so I can flesh out the confusing bits in more detail. </p>