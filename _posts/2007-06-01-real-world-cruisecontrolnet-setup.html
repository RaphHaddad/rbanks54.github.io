---
layout: post
title: A Real World CruiseControl.NET Setup
date: '2007-06-01T15:44:00.003+10:00'
author: Richard Banks
tags:
- tools
- CruiseControl.NET
- development
modified_time: '2010-03-25T09:05:40.810+11:00'
thumbnail: http://bp3.blogger.com/_5dD_rBQSs2o/Rl-6whM4WMI/AAAAAAAAAB4/bvktYXemhu0/s72-c/ccnet+dashboard.png
blogger_id: tag:blogger.com,1999:blog-13321238.post-2687037005165211003
blogger_orig_url: http://www.richard-banks.org/2007/06/real-world-cruisecontrolnet-setup.html
---

<a href="http://ccnet.thoughtworks.com/">CruiseControl.NET</a> is a fantastic open source tool for running <a title="Wikipedia Entry on Continuous Integration" href="http://en.wikipedia.org/wiki/Continuous_Integration">Continuous</a> <a href="http://www.xprogramming.com/xpmag/whatisxp.htm#continuous">Integration</a> processes in your development team.<p></p> <p>I've been using CCNet with teams for many years now and it works beautifully.  Of course these days you can also do continuous integration with a number of other products like Microsoft's <a href="http://msdn2.microsoft.com/en-us/teamsystem/aa718825.aspx">Team Foundation Server</a> or any of the various other offerings out there, but CCNet is the still going strong with <a href="http://confluence.public.thoughtworks.org/display/CCNET/CCNet+1.2+Release+Notes">version 1.2</a> recently released.</p> <p>The details below are for the configuration I've used on my most recent project (names changed for privacy).  It's a line of business web application consisting of around 25 projects and a few hundred web forms.</p> <h4>The Environment</h4> <p>The development environment has a 4 CPU HP server running <a href="http://www.vmware.com/products/vi/esx/">VMWare ESX</a> and has a number of test servers and so forth setup on it.  The build server itself is one of the virtual servers.  It is configured for 2 CPU's, 1 GB Ram and 20 GB of disk.</p> <p>For simplicity, this server is also where the <a href="http://subversion.tigris.org/">Subversion</a> source repository is located.</p> <p>The disk space is split into 3 drives.  The system disk has 8 GB on it, there is a 4 GB disk for build log files, and the rest is allocated to the build server and the subversion repository. </p> <p>Developers have the <a href="http://tortoisesvn.tigris.org/">TortoiseSVN</a> client on their machines for Subversion access and the <a href="http://confluence.public.thoughtworks.org/display/CCNET/CCTray">CCTray</a> tool installed so they can see the current state of the build server (and know when someone breaks the build).</p> <p><a href="http://www.countersoft.com/">Gemini</a> is used as the issue tracking system and we have integrated Subversion commits into the Gemini solution.</p> <h4>Server Software</h4> <p>The build server has the following software installed:</p> <ul> <li><a href="http://ccnet.thoughtworks.com/">CruiseControl.NET</a> (obviously!)</li> <li><a href="http://www.nunit.org/">NUnit 2.2</a></li> <li><a href="http://www.gotdotnet.com/Team/FxCop/">FxCop 1.35</a></li> <li><a href="http://nant.sourceforge.net/">NAnt</a> 0.85 (and <a href="http://nantcontrib.sourceforge.net/">NAnt-Contrib</a> 0.85)</li> <li><a href="http://ncover.org/">NCover</a></li> <li><a href="http://www.kiwidude.com/dotnet/DownloadPage.html">NCoverExplorer</a></li> <li>Microsoft .NET Framework SDK</li> <li><a href="http://www.campwoodsw.com/">SourceMonitor</a></li> <li>IIS (for the CCNet WebDashboard interface)</li></ul> <p>You'll notice that Visual Studio is NOT installed on the build server.  Also, the software being built uses 3rd party components from Telerik, Dundas and others.  These 3rd party products are also NOT installed on the build server.</p> <p>Finally, we use MSBuild in the process.  You'll need the <a href="http://ccnetlive.thoughtworks.com/MSBuildXmlLogger-Builds/">MSBuild Logger</a> in order to get MSBuild output readable in the Web Dashboard.</p> <h4>The Build Process</h4> <p>The build process is pretty simple.  Here's how it works:</p> <ul> <li>Developer commits code into Subversion</li> <li>CruiseControl.NET detects that a commit has occurred</li> <li>The buils direcortory is cleaned</li> <li>CCNet checks out the code into the local working directory on the build server</li> <li>3rd party DLL's are copied into the bin directory for the web site</li> <li>.config.template files are copied to .config files</li> <li>Assembly numbers are updated to match the Subversion revision number</li> <li>MSBuild is called to compile the solution</li> <li>Unit tests are run (with NCover for code coverage)</li> <li>NCoverExplorer is run over the NCover output</li> <li>FxCop is run.  This step can fail, as we expect some FxCop validation errors on legacy code</li> <li>SourceMonitor is run </li></ul> <p>If any step (except FxCop) fails, we stop immediately.</p> <p>If it all works, we then create a folder containing the application in a ready-to-release state as follows:</p> <ul> <li>Clean out the existing contents in the release folder</li> <li>Copy everything from PrecompiledWeb</li> <li>Create default blank folders (e.g. upload folders, etc that are part of the applications standard configuration)</li> <li>Copy in extra non-build items, including things such as deployment untilities and help files</li></ul> <p>And that's it.</p> <p>One interesting thing to note is what we do with .config files.  In VS2005 standard web applications require a web.config file to help figure out where references are, and so forth.  Unfortunately in a development environment developers often use different config files to those of other developers and those on the build server (eg connection strings, logging and debug settings, etc).  We use the concept of a baseline web.config file called web.config.template.  This .config.template file is what is used by the build server to set the defaults for the application both in terms of compilation and standard deployment/runtime configuration options.</p> <h4>The Web Dashboard</h4> <p>The web dashboard is the web interface to the ccnet build server.  We have configured this to show more information about the build process than that provided in the base CruiseControl.NET installation.</p> <p>Our dashboard looks like this:</p> <p><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://bp3.blogger.com/_5dD_rBQSs2o/Rl-6whM4WMI/AAAAAAAAAB4/bvktYXemhu0/s1600-h/ccnet+dashboard.png"><img style="cursor: pointer;" src="http://bp3.blogger.com/_5dD_rBQSs2o/Rl-6whM4WMI/AAAAAAAAAB4/bvktYXemhu0/s400/ccnet+dashboard.png" alt="" id="BLOGGER_PHOTO_ID_5070977048151349442" border="0" /></a></p> <p>The build log now included the Subversion revision number and provides people with the ability to view the NCover output using NCoverExplorer, the MSBuild output (for finding why builds fail - as you can see, sometimes they do!) and SourceMonitor output.</p> <h4>How Is It Configured?</h4> <p>All the configuration information here assumes you've already set up CruiseControl.NET and understand the basics of how to configure it.</p> <p>Let's start with the web dashboard.  We've changed the &lt;buildPlugins&gt; section in dashboard.config to look like this:</p><p style="font-style: italic;">P.S. Apologies for the formatting - blogger got all "helpful" and removed the leading whitespace<br /></p> <p><br /><pre class="brush: xml">&lt;buildPlugins&gt;<br /> &lt;buildReportBuildPlugin&gt;<br />     &lt;xslFileNames&gt;<br />         &lt;xslFile&gt;xsl\header_with_revision.xsl&lt;/xslFile&gt;<br />         &lt;xslFile&gt;xsl\modifications.xsl&lt;/xslFile&gt;<br />         &lt;xslFile&gt;xsl\compile.xsl&lt;/xslFile&gt;<br />         &lt;xslFile&gt;xsl\unittests.xsl&lt;/xslFile&gt;<br />         &lt;xslFile&gt;xsl\MsTestSummary.xsl&lt;/xslFile&gt;<br />         &lt;xslFile&gt;xsl\NCoverExplorerSummary.xsl&lt;/xslFile&gt;<br />         &lt;xslFile&gt;xsl\fxcop_new_summary.xsl&lt;/xslFile&gt;<br />         &lt;xslFile&gt;xsl\sourcemonitor-summary.xsl&lt;/xslFile&gt;<br />         &lt;xslFile&gt;xsl\compile-msbuild.xsl&lt;/xslFile&gt;<br />     &lt;/xslFileNames&gt;<br /> &lt;/buildReportBuildPlugin&gt;<br /> &lt;buildLogBuildPlugin /&gt;<br /> &lt;xslReportBuildPlugin description="NUnit Details" actionName="NUnitDetailsBuildReport" xslFileName="xsl\tests.xsl" /&gt;<br /> &lt;xslReportBuildPlugin description="NUnit Timings" actionName="NUnitTimingsBuildReport" xslFileName="xsl\timing.xsl" /&gt;<br /> &lt;xslReportBuildPlugin description="NCover Report" actionName="NCoverBuildReport" xslFileName="xsl\NCoverExplorer.xsl" /&gt;<br /> &lt;xslReportBuildPlugin description="NCover Details" actionName="NCoverDetailsReport" xslFileName="xsl\NCover-details.xsl" /&gt;<br /> &lt;xslReportBuildPlugin description="FxCop Report" actionName="FxCopBuildReport" xslFileName="xsl\FxCop_new.xsl" /&gt;<br /> &lt;xslReportBuildPlugin description="MSBuild Report" actionName="MSBuildOutputBuildPlugin" xslFileName="xsl\msbuild.xsl"/&gt;<br /> &lt;xslReportBuildPlugin description="NAnt Output" actionName="NAntOutputBuildReport" xslFileName="xsl\Nant.xsl" /&gt;<br /> &lt;xslReportBuildPlugin description="NAnt Timings" actionName="NAntTimingsBuildReport" xslFileName="xsl\NantTiming.xsl" /&gt;<br /> &lt;xslReportBuildPlugin description="SourceMonitor Top 30" actionName="SourcemMonitorTop15BuildReport" xslFileName="xsl\SourceMonitor-Top15.xsl"/&gt;<br /> &lt;xslReportBuildPlugin description="SourceMonitor Files" actionName="SourcemMonitorFileBuildReport" xslFileName="xsl\sourcemonitor-group-by-file.xsl"/&gt;<br /> &lt;xslReportBuildPlugin description="SourceMonitor Metrics" actionName="SourcemMonitorMetricBuildReport" xslFileName="xsl\sourcemonitor-group-by-metric.xsl"/&gt;  </pre></p><p> </p> <p>There is a new .xsl file to add the subversion revision to the build output.  See <a href="http://richardsbraindump.blogspot.com/2007/01/add-subversion-revision-to.html">my previous post</a> for more information.</p> <p>We also add a few new build plugins to allow us to view the XML output from programs like SourceMonitor & NCover in the web dashboard.</p> <h4>The Project's CCNet Configuration</h4> <p>When CCNet is set up you need to edit ccnet.config to tell it about the projects you are building.</p> <p>The configuration for our project is as follows</p> <p><pre class="brush:xml"> &lt;project name="xxxx"&gt;<br /> &lt;workingDirectory&gt;D:\CCProjects\xxxx&lt;/workingDirectory&gt;<br /> &lt;artifactDirectory&gt;E:\CCArtifacts\xxxx&lt;/artifactDirectory&gt;<br /> &lt;webURL&gt;<a href="http://ccnet.server.local/ccnet">http://ccnet.server.local/ccnet</a>&lt;/webURL&gt;<br /> &lt;modificationDelaySeconds&gt;0&lt;/modificationDelaySeconds&gt;<br /> &lt;publishExceptions&gt;true&lt;/publishExceptions&gt;<br /> &lt;triggers&gt;<br />         &lt;intervalTrigger seconds="60" /&gt;<br /> &lt;/triggers&gt;<br /> &lt;sourcecontrol type="svn"&gt;<br />     &lt;trunkUrl&gt;"file:///D:/svnrepos/xxxx/trunk"&lt;/trunkUrl&gt;<br />     &lt;workingDirectory&gt;D:\CCProjects\xxxx&lt;/workingDirectory&gt;<br />     &lt;executable&gt;C:\Program Files\Subversion\bin\svn.exe&lt;/executable&gt;<br /> &lt;/sourcecontrol&gt;<br /> &lt;tasks&gt;<br />     &lt;nant&gt;<br />       &lt;executable&gt;C:\program files\nant-0.85-rc4\bin\nant.exe&lt;/executable&gt;<br />       &lt;baseDirectory&gt;D:\CCProjects\xxxx&lt;/baseDirectory&gt;<br />       &lt;nologo&gt;true&lt;/nologo&gt;<br />       &lt;buildFile&gt;default.build&lt;/buildFile&gt;<br />       &lt;logger&gt;NAnt.Core.XmlLogger&lt;/logger&gt;<br />       &lt;targetList&gt;<br />         &lt;target&gt;compile&lt;/target&gt;<br />       &lt;/targetList&gt;<br />       &lt;buildTimeoutSeconds&gt;6000&lt;/buildTimeoutSeconds&gt;<br />     &lt;/nant&gt;<br /> &lt;/tasks&gt;<br /> &lt;publishers&gt;<br />         &lt;merge&gt;<br />         &lt;files&gt;<br />             &lt;file&gt;D:\CCProjects\xxxx\_msbuild.xml&lt;/file&gt;<br />             &lt;file&gt;D:\CCProjects\xxxx\_nunit_*.xml&lt;/file&gt;<br />             &lt;file&gt;D:\CCProjects\xxxx\_ncover_*.xml&lt;/file&gt;<br />             &lt;file&gt;D:\CCProjects\xxxx\_coverageReport.xml&lt;/file&gt;<br />             &lt;file&gt;D:\CCProjects\xxxx\_fxcop_*.xml&lt;/file&gt;<br />             &lt;file&gt;D:\CCProjects\xxxx\_sm_*.xml&lt;/file&gt;<br />         &lt;/files&gt;<br />         &lt;/merge&gt;<br />     &lt;xmllogger /&gt;<br /> &lt;/publishers&gt;<br />&lt;/project&gt; </pre></p><p>You can see that the sourcecontrol section is set up for Subversion (type="svn") and that we use an NAnt task to kick off the build when a commit is detected in Subversion.</p> <p>The &lt;publishers&gt; section is where all the xml output files are processed and merged to produce the information displayed on the web dashboard.  As a naming convention all XML build logs are named as _file.xml.  This makes it easier to clean up things when the next build starts.</p> <p> </p> <p>The actual NAnt task that is executed when a change is detected is shown here</p> <p><pre class="brush:xml">&lt;?xml version="1.0"?&gt;<br />&lt;project name="FullSolution" default="compile"&gt;<br /> &lt;property name="contrib" value="C:\program files\nantcontrib-0.85-rc4" overwrite="true" /&gt;<br /> &lt;property name="sourceDir" value="D:\CCProjects\xxxx" overwrite="true" /&gt;<br /> &lt;property name="svnUri" value="file:///D:/svnrepos/xxxx/trunk" overwrite="true" /&gt;<br /> &lt;property name="winDir" value="c:\windows" overwrite="true" /&gt;<br /> &lt;property name="nunit-location" value="c:\Program Files\NUnit-Net-2.0 2.2.8\bin" overwrite="true" /&gt;<br /> &lt;property name="nunit-console" value="${nunit-location}\nunit-console.exe" overwrite="true" /&gt;<br /> &lt;property name="fxcop-console" value="c:\Program Files\Microsoft FxCop 1.35\FxCopCmd.exe" overwrite="true" /&gt;<br /> &lt;property name="ncover-console" value="c:\Program Files\ncover\ncover.console.exe" overwrite="true" /&gt;<br /> &lt;property name="ncoverexplorer-console" value="C:\Program Files\NCover\NCoverExplorer\ncoverexplorer.console.exe" overwrite="true" /&gt;<br /> &lt;target name="*"&gt;<br />     &lt;nant target="${target::get-current-target()}" buildfile="xxxx/default.build" /&gt;<br />     &lt;nant target="releaseIt" buildfile="makeRelease.build" /&gt;<br /> &lt;/target&gt;<br />&lt;/project&gt; </pre></p><p>  </p><p>First we just set up a number of properties pointing to the location of the various tools we'll use when the build actually executes.   </p><p>Next we call two NAnt targets, one that does to build, and one that does the release.  If the build step fails then the release step is skipped. </p><p>  </p><h4>The NAnt Build Script</h4> <p>Now, finally we get to the fun part.  The NAnt build script. </p><p>There's a fair bit of detail in the build, but the targets are as follows: </p><p><strong>SVN:</strong>  Gets the source from Subversion and the revision number </p><p><strong>Compile</strong>:  Calls clean and SVN targets first, then set's the Assembly version numbers, checks codebehind vs codefile issues and executes MSBuild before running post build targets </p><p><strong>Clean:</strong> Removes previous compilation output and xml log files </p><p><strong>GetAssemblyVersion:</strong> Reads the assembly version number from AssemblyInfo.cs and stores is in NAnt properties </p><p><strong>SetAssemblyVersion:</strong> Edits the AssemblyInfo.cs files for various projects using the Subversion revision number </p><p><strong>CodeBehindToFile:</strong>  Switches any "CodeBehind" ASP directives to "CodeFile" directives.  Developers typically use the Web Application project in VS2005 so that local compiles are quick.  The build server uses the Web Site project so that we get full compilation up front and avoid any nasty run time surprises.  Unfortunately web applications use CodeBehind in the aspx pages, while the web site uses the CodeFile directive.  This ensures that developers can use either without worrying about screwing up the build server. </p><p><strong>unitTests:</strong> It runs the unit tests!  But you'll note it does it via NCover so that we can get coverage analysis performed. </p><p><strong>nCoverExplorer:</strong> It processes the NCover XML output using the console application and creates summarised XML output that makes it a lot easier to view results in the Web Dashboard. </p><p><strong>FxCop:</strong> Pretty simple - just runs FxCop over all the .DLL's it can find.  We skip 3rd party .DLL's as we can't really do anything about them if they have FxCop violations. </p><p><strong>SourceMonitor:</strong>  Runs the sourceMonitor console app to process the code and calculate cyclomatic complexity values and finds the nastiest, ugliest code it can so that we have a hot-list of methods that need refactoring. </p><p>  </p><p>Here's the NAnt build script in full (well, slightly edited for privacy): </p><p><pre class="brush:xml">&lt;?xml version="1.0" ?&gt;<br />&lt;project name="xxxx" default="compile" basedir="."&gt;<br /> &lt;description&gt;Build the xxxx Application&lt;/description&gt;<br /> &lt;property name="clean.pattern.bin" value="**/bin/**/*" /&gt;<br /> &lt;property name="clean.pattern.obj" value="**/obj/**/*" /&gt;<br /> &lt;property name="clean.pattern.precompiled" value="**/precompiledweb/**/*" /&gt;<br /> &lt;property name="clean.pattern.assemblyinfo" value="**/assemblyinfo.cs" /&gt;<br /> &lt;property name="clean.pattern.xml" value="_*.xml" /&gt;<br /> &lt;property name="build.major" value="1"/&gt;<br /> &lt;property name="build.minor" value="0"/&gt;<br /> &lt;property name="build.build" value="0"/&gt;<br /> &lt;property name="build.revision" value="0"/&gt;<br /> &lt;property name="svn.revision" value="0"/&gt;<br /> &lt;property name="assemblyinfo.location" value="xxxx\App_Code\AssemblyInfo.cs"/&gt;<br /> &lt;property name="counter" value="0"/&gt;<br /> &lt;property name="codemetrics.output.dir" value="c:\temp"/&gt;<br /> &lt;property name="sourcemonitor.executable" value="c:\Program Files\SourceMonitor\SourceMonitor.exe"/&gt;<br /></pre></p> <p><pre class="brush:xml">    &lt;target name="svn" description="Get source code from Subversion"&gt;<br />     &lt;loadtasks assembly="${contrib}\bin\NAnt.Contrib.Tasks.dll" /&gt;<br />     &lt;echo message="loaded tasks from ${contrib}\bin\NAnt.Contrib.Tasks.dll" /&gt;<br />     &lt;svn-update destination="${sourceDir}" uri="${svnUri}"/&gt;<br />     &lt;echo message="Retrieving Subversion revision number"/&gt;<br />     &lt;exec<br />       program="svn.exe"<br />       commandline='log "${project::get-base-directory()}" --xml --limit 1'<br />       output="_revision.xml"<br />       failonerror="false"/&gt;<br />     &lt;xmlpeek<br />       file="_revision.xml"<br />       xpath="/log/logentry/@revision"<br />       property="svn.revision"<br />       failonerror="false"/&gt;<br />     &lt;echo message="Using Subversion revision number: ${svn.revision}"/&gt;<br /> &lt;/target&gt;<br /></pre></p> <p><pre class="brush:xml">    &lt;target name="compile" depends="clean,svn"&gt;<br />     &lt;copy file="ThirdPartyAssemblies\RadAjax.Net2.DLL" tofile="xxxx/bin/RadAjax.Net2.DLL" overwrite="true"/&gt;<br />     &lt;copy file="xxxx\xxxx.config.template" tofile="xxxx\xxxx.config" overwrite="true"/&gt;<br />     &lt;call target="SetAssemblyVersion"/&gt;<br />     &lt;call target="CodeBehindToFile"/&gt;<br />     &lt;exec<br />       program="${winDir}\microsoft.net\framework\v2.0.50727\msbuild.exe"<br />       commandline='xxxx.sln /p:Configuration=Release /logger:ThoughtWorks.CruiseControl.MsBuild.XmlLogger,..\ThoughtWorks.CruiseControl.MSBuild.dll /noconsolelogger /nologo /noautorsp'<br />       output="_msbuild.xml"<br />       failonerror="true"/&gt;<br />     &lt;call target="unitTests"/&gt;<br />     &lt;call target="ncoverExplorer"/&gt;<br />     &lt;call target="FxCop"/&gt;<br />     &lt;call target="sourcemonitor"/&gt;<br /> &lt;/target&gt;<br /> &lt;target name="unitTests"&gt;<br />     &lt;foreach item="File" property="filename"&gt;<br />     &lt;in&gt;<br />         &lt;items&gt;<br />             &lt;include name="xxxx\bin\*.dll"&gt;&lt;/include&gt;<br />             &lt;include name="**\bin\*\*tests.dll"&gt;&lt;/include&gt;<br />             &lt;exclude name="**\Castle.DynamicProxy.dll" /&gt;<br />         &lt;/items&gt;<br />     &lt;/in&gt;<br />     &lt;do&gt;<br />         &lt;exec program="${ncover-console}" workingdir="${path::get-directory-name(filename)}" commandline="&amp;quot;${nunit-console}&amp;quot; ${filename} /xml:${project::get-base-directory()}\_nunit_${path::get-file-name-without-extension(filename)}.xml /nologo //x ${project::get-base-directory()}\_ncover_${path::get-file-name-without-extension(filename)}.xml" failonerror="true"/&gt;<br />     &lt;/do&gt;<br />     &lt;/foreach&gt;<br /> &lt;/target&gt; </pre></p> <p><pre class="brush:xml">    &lt;!-- Run NCover Explorer over results for summary output --&gt;<br /> &lt;target name="ncoverExplorer"&gt;<br />     &lt;echo message="Starting NCoverExplorer report generation..."/&gt;<br />     &lt;exec program="${ncoverexplorer-console}"<br />           workingdir="${project::get-base-directory()}" &gt;<br />         &lt;arg value="_ncover_*.xml" /&gt;<br />         &lt;arg value="/r:5"/&gt;<br />         &lt;arg value="/x:_CoverageReport.xml" /&gt;<br />         &lt;arg value="/e" /&gt;<br />         &lt;arg value="/p:xxxx" /&gt;<br />         &lt;arg value="/m:85" /&gt;<br />     &lt;/exec&gt;<br /> &lt;/target&gt;  </pre></p><p><pre class="brush:xml">    &lt;target name="clean" description="remove generated files"&gt;<br />     &lt;delete&gt;<br />         &lt;fileset&gt;<br />             &lt;include name="${clean.pattern.obj}"/&gt;<br />             &lt;include name="${clean.pattern.bin}"/&gt;<br />             &lt;include name="${clean.pattern.precompiled}"/&gt;<br />             &lt;include name="${clean.pattern.assemblyinfo}"/&gt;<br />             &lt;include name="${clean.pattern.xml}"/&gt;<br />         &lt;/fileset&gt;<br />     &lt;/delete&gt;<br /> &lt;/target&gt;<br /> &lt;!-- Populates variables (build.major, build.minor, build.build, and build.revision) with values<br />     from AssemblyInfo.cs.  If property assemblyinfo.location is undefined, it will attempt to<br />     read AssemblyInfo.cs from the current directory. --&gt;<br /> &lt;target name="GetAssemblyVersion" description="Populates variables with the current version." &gt;<br />     &lt;script language="C#"&gt;<br />         &lt;code&gt;&lt;![CDATA[<br />         public static void ScriptMain(Project project) {<br />              string fileName = Path.Combine(project.BaseDirectory, project.Properties["assemblyinfo.location"]);<br />              StreamReader reader = new StreamReader(fileName);<br />             {<br />                 Regex expression = new Regex(@"AssemblyVersion");<br />                 string line = reader.ReadLine();<br />                 while (line != null) {<br />                     Match match = expression.Match(line);<br />                     if (match.Success) {<br />                          Regex pattern = new Regex("[0-9]+");<br />                          MatchCollection matches = pattern.Matches(line);<br />                          if (matches.Count != 4)<br />                           throw new Exception(string.Format("Version number in {0} has incorrect format.", fileName));<br />                          int major = int.Parse(matches[0].Value);<br />                          int minor = int.Parse(matches[1].Value);<br />                          int build = int.Parse(matches[2].Value);<br />                          int revision = int.Parse(matches[3].Value);<br />                          project.Properties["build.major"] = major.ToString();<br />                          project.Properties["build.minor"] = minor.ToString();<br />                          project.Properties["build.build"] = build.ToString();<br />                          project.Properties["build.revision"] = revision.ToString();<br />                         break;<br />                     }<br />                     line = reader.ReadLine();<br />                 }<br />             }<br />              reader.Close();<br />             }<br />        ]]&gt;&lt;/code&gt;<br />     &lt;/script&gt;<br />     &lt;echo message="major: ${build.major}"/&gt;<br />     &lt;echo message="minor: ${build.minor}"/&gt;<br />     &lt;echo message="build: ${build.build}"/&gt;<br />     &lt;echo message="revision: ${build.revision}"/&gt;<br /> &lt;/target&gt;  </pre></p><p><pre class="brush:xml">    &lt;!--    Change CodeBehind=" instances to CodeFile="    --&gt;<br /> &lt;target name="CodeBehindToFile" description="Fixes the web application web site annoyance"&gt;<br />     &lt;foreach item="File" property="filename"&gt;<br />         &lt;in&gt;<br />             &lt;items&gt;<br />                 &lt;include name="xxxx\*.aspx"&gt;&lt;/include&gt;<br />                 &lt;include name="xxxx\UserControl\*.ascx"&gt;&lt;/include&gt;<br />             &lt;/items&gt;<br />         &lt;/in&gt;<br />         &lt;do&gt;<br />             &lt;script language="C#"&gt;<br />             &lt;code&gt;&lt;![CDATA[<br />             public static void ScriptMain(Project project) {<br />                 string contents;<br />                 using ( StreamReader reader = new StreamReader ( project.Properties [ "filename" ] ) )<br />                 {<br />                     contents = reader.ReadToEnd ();<br />                     reader.Close ();<br />                 }<br />                 contents = System.Text.RegularExpressions.Regex.Replace(contents,"CodeBehind=\"","CodeFile=\"",System.Text.RegularExpressions.RegexOptions.IgnoreCase);<br />                 using ( StreamWriter writer = new StreamWriter ( project.Properties [ "filename" ] , false ) )<br />                 {<br />                     writer.Write ( contents );<br />                     writer.Close ();<br />                 }<br />             }<br />             ]]&gt;&lt;/code&gt;<br />             &lt;/script&gt;<br />         &lt;/do&gt;<br />     &lt;/foreach&gt;<br /> &lt;/target&gt;  </pre></p><p><pre class="brush:xml">    &lt;target name="SetAssemblyVersion" description="Increments/Sets the AssemblyVersion value" depends="GetAssemblyVersion"&gt;<br />     &lt;!-- Increment the build.revision value --&gt;<br />     &lt;foreach item="File" property="filename"&gt;<br />     &lt;in&gt;<br />         &lt;items&gt;<br />             &lt;include name="xxxx\App_Code\AssemblyInfo.cs"&gt;&lt;/include&gt;<br />             &lt;include name="Project2\AssemblyInfo.cs"&gt;&lt;/include&gt;<br />             &lt;include name="Project3\AssemblyInfo.cs"&gt;&lt;/include&gt;<br />         &lt;/items&gt;<br />     &lt;/in&gt;<br />     &lt;do&gt;<br />         &lt;script language="C#"&gt;<br />         &lt;code&gt;&lt;![CDATA[<br />         public static void ScriptMain(Project project) {<br />             string contents = "";<br />             StreamReader reader = new StreamReader(project.Properties["filename"]);<br />             contents = reader.ReadToEnd();<br />             reader.Close();<br />             string replacement = string.Format(<br />                 "AssemblyVersion(\"{0}.{1}.{2}.{3}\")]",<br />                 project.Properties["build.major"],<br />                 project.Properties["build.minor"],<br />                 project.Properties["build.build"],<br />                 project.Properties["svn.revision"]<br />             );  <br /><br />                string newText = Regex.Replace(contents, @"AssemblyVersion\("".*""\)\]", replacement);<br />             StreamWriter writer = new StreamWriter(project.Properties["filename"], false);<br />             writer.Write(newText);<br />             writer.Close();<br />         }        <br />         ]]&gt;&lt;/code&gt;<br />         &lt;/script&gt;<br />       &lt;/do&gt;<br />     &lt;/foreach&gt;<br /> &lt;/target&gt;  <br /><br />    &lt;target name="FxCop"&gt;<br />     &lt;exec program="${fxcop-console}" commandline="/file:precompiledweb/xxxx/bin /out:_fxcop_all.xml /directory:&amp;quot;${nunit-location}" /searchgac" failonerror="false"/&gt;<br />     &lt;!--<br />     &lt;foreach item="File" property="filename"&gt;<br />     &lt;in&gt;<br />         &lt;items&gt;<br />             &lt;include name="precompiledweb\xxxx\bin\*.dll"&gt;&lt;/include&gt;<br />             &lt;exclude name="**\Castle.DynamicProxy.dll" /&gt;<br />         &lt;/items&gt;<br />     &lt;/in&gt;<br />     &lt;do&gt;<br />     &lt;exec program="${fxcop-console}" commandline="/file:${filename} /out:_fxcop_${path::get-file-name-without-extension(filename)}.xml /directory:&amp;quot;${nunit-location}" /searchgac" failonerror="false"/&gt;<br />     &lt;/do&gt;<br />     &lt;/foreach&gt;<br />     --&gt;<br /> &lt;/target&gt;<br /> &lt;target name="sourcemonitor"&gt;<br />     &lt;!-- Create input command file --&gt;<br />     &lt;property name="sourcemonitor.input" value="${codemetrics.output.dir}\sm_xxxx_cmd.xml" /&gt;<br />     &lt;echo file="${sourcemonitor.input}" append="false" failonerror="false"&gt;<br />       &lt;![CDATA[<br />       &lt;?xml version="1.0" encoding="UTF-8" ?&gt;<br />       &lt;sourcemonitor_commands&gt;<br />        &lt;write_log&gt;true&lt;/write_log&gt;<br />        &lt;command&gt;<br />         &lt;project_file&gt;${codemetrics.output.dir}\sm_xxxx.smp&lt;/project_file&gt;<br />         &lt;project_language&gt;CSharp&lt;/project_language&gt;<br />         &lt;source_directory&gt;${project::get-base-directory()}&lt;/source_directory&gt;<br />         &lt;include_subdirectories&gt;true&lt;/include_subdirectories&gt;<br />         &lt;checkpoint_name&gt;${svn.revision}&lt;/checkpoint_name&gt;<br />         &lt;export&gt;<br />          &lt;export_file&gt;${project::get-base-directory()}\_sm_summary.xml&lt;/export_file&gt;<br />          &lt;export_type&gt;1&lt;/export_type&gt;<br />         &lt;/export&gt;<br />        &lt;/command&gt;<br />        &lt;command&gt;<br />         &lt;project_file&gt;${codemetrics.output.dir}\sm_xxxx.smp&lt;/project_file&gt;<br />         &lt;checkpoint_name&gt;${svn.revision}&lt;/checkpoint_name&gt;<br />         &lt;export&gt;<br />          &lt;export_file&gt;${project::get-base-directory()}\_sm_details.xml&lt;/export_file&gt;<br />          &lt;export_type&gt;2&lt;/export_type&gt;<br />         &lt;/export&gt;<br />        &lt;/command&gt;<br />       &lt;/sourcemonitor_commands&gt;<br />       ]]&gt;<br />      &lt;/echo&gt;<br />     &lt;!-- Execute the commands --&gt;<br />     &lt;exec program="${sourcemonitor.executable}" commandline="/C ${sourcemonitor.input}" failonerror="false" /&gt;<br />     &lt;style style="SourceMonitor-Top15Generation.xsl" in="${project::get-base-directory()}\_sm_details.xml" out="${project::get-base-directory()}\_sm_top15.xml" /&gt;<br />     &lt;delete file="${codemetrics.output.dir}\sm_xxxx.smp" failonerror="false" /&gt;<br /> &lt;/target&gt;<br />&lt;/project&gt; </pre></p><p>  </p><p>  </p><p>Hopefully you find that useful, and that there's some ideas in there you can borrow.  If you've got any questions please feel free to ask.</p>