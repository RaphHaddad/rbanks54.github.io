---
layout: post
title: How to Use CodedUI Tests, Watin and MTM Together
date: '2010-11-08T16:45:00.002+11:00'
author: Richard Banks
tags:
- testing
- TFS
modified_time: '2010-11-08T16:48:09.529+11:00'
thumbnail: http://lh5.ggpht.com/_5dD_rBQSs2o/TNeOaw3i9FI/AAAAAAAAA6M/cHD_keWODvk/s72-c/image_thumb%5B5%5D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-2603013876113629998
blogger_orig_url: http://www.richard-banks.org/2010/11/how-to-use-codedui-tests-watin-and-mtm.html
---

<p>A customer I’m working with has placed a heavy investment in Watin testing over the years and with a recent move to TFS2010 they also wanted to take advantage of the new Microsoft Test Manager (MTM) feature and the ability to associate automated tests to test cases in MTM.&#160; Here’s a quick how-to for those of you wanting to do the same thing.</p>  <h3>Create A Test Case</h3>  <p>First up, let’s create a test case:</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TNeOZa2-PJI/AAAAAAAAA6I/UQtzaXn5nwU/s1600-h/image%5B9%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TNeOaw3i9FI/AAAAAAAAA6M/cHD_keWODvk/image_thumb%5B5%5D.png?imgmax=800" width="484" height="435" /></a></p>  <p>Pretty simple – open browser and check the url in the address bar.&#160; What I have also done with this test is use parameters to supply the data allowing testers to decide what values they want to test with.&#160; This is better than the devs doing this, plus it makes for a much nicer UI for data driven tests than excel or CSV files do.</p>  <h3>Create The CodedUI Watin Test</h3>  <p>Next we need to create the automation for this test.</p>  <p>Add a Coded UI test class to a test project but don’t go create any tests via the wizard that appears.&#160; Just press cancel and then go to your test code and add a normal Watin test as per usual.&#160; Oh, if you’re a person who normally deletes all that TestContext stuff, then you’ll need to leave it in place this time around – don’t delete it.</p>  <p>Here’s an example:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:f1a2aab0-9d82-4ecf-9674-a6562c405324" class="wlWriterEditableSmartContent"><pre class="brush: c#;">using Microsoft.VisualStudio.TestTools.UITesting;<br />using Microsoft.VisualStudio.TestTools.UnitTesting;<br />using WatiN.Core;<br /><br />namespace CodedUITesting<br />{<br />    [CodedUITest]<br />    public class CodedUITest1<br />    {<br />    ...<br />    [TestMethod]<br />    [DataSource("Microsoft.VisualStudio.TestTools.DataSource.TestCase",<br /> "http://tfs2008-vm:8080/tfs/TemplateTrials;Scrum v5",<br /> "101", DataAccessMethod.Sequential)]<br />    public void RunWatinTestParameterized()<br />    {<br /> var url = TestContext.DataRow["url"].ToString();<br /> var result = TestContext.DataRow["result"].ToString();<br /> using (IE ie = new IE(url))<br /> {<br />  Assert.AreEqual(result, ie.Url);<br /> }<br />    }<br />}</pre></div><p>The things to note in this test are that the data source attribute is used to pull data from the TFS Test Case work item – specifically the URL of the team project is included, as it the test case id.&#160; </p><p>In the test itself we pull data from the parameters in the test case using the TestContext.DataRow[“parameter'NameHere”].ToString() calls, and the rest is just normal Watin code.</p><p>If you have any issues with missing references make sure you reference Watin and Interop.ShDocVw and that both get copied to the output folder as part of the build.</p><h3>Attach the Automation</h3><p>The only thing we need to do once we have this test is to link it to the test case as it’s automation method.&#160; Open the test case in Visual Studio, navigate to the Associated Automation tab and click the […] button to select the method.&#160; You should see something like this once it’s done:</p><p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TNeObvRVSLI/AAAAAAAAA6Q/1CQKgM1FIzU/s1600-h/image%5B11%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TNeOcdZWeaI/AAAAAAAAA6U/7k5iQFYvQKA/image_thumb%5B7%5D.png?imgmax=800" width="484" height="257" /></a></p><h3>Run The Test</h3><p>Assuming you have a lab environment with test agents installed you should then be able to trigger a new build and when it’s complete start an automated test run for that build and see everything working as you would expect.</p><p>Here’s a result from a run on my local TFS server:</p><p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TNeOdbXRCvI/AAAAAAAAA6Y/tzTfj9AVeXw/s1600-h/image%5B15%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TNeOezL4DmI/AAAAAAAAA6c/bj3R17U9NWk/image_thumb%5B9%5D.png?imgmax=800" width="484" height="456" /></a></p><p>I hope this helps!</p>