---
layout: post
title: Some TeamBuild Fun and Games
date: '2009-07-20T13:50:00.001+10:00'
author: Richard Banks
tags: 
modified_time: '2009-07-20T13:50:22.104+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-2648264854831359435
blogger_orig_url: http://www.richard-banks.org/2009/07/some-teambuild-fun-and-games.html
---

<p>I’ve just spent the morning helping a client with a few team build problems they were having using a newly installed TFS2008 server and a new build server.</p> <h3>Where’s LC.exe?</h3> <p>The first problem they had was that when they were running their build they were getting an error as follows:</p> <p>Task failed because "LC.exe" was not found, or the .NET Framework SDK v2.0 is not installed.&nbsp; The task is looking for "LC.exe" in the "bin" subdirectory beneath the location specified in the SDKInstallRootv2.0 value of the registry key HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework.&nbsp; You may be able to solve the problem by doing one of the following:&nbsp; 1.) Install the .NET Framework SDK v2.0.&nbsp; 2.) Manually set the above registry key to the correct location.&nbsp; 3.) Pass the correct location into the "ToolPath" parameter of the task.</p> <p>LC.exe is the program the is used to processes the *.licx files when dealing with 3rd party custom controls (they were using Janus controls) and for some reason the file couldn’t be loaded even though the LC.exe file could be found on the disk.</p> <p>The thing to note for this is that they were using a new build server.&nbsp; It has TeamBuild 2008 and VS2008 SP1 installed and was successfully building a separate project (that didn’t have licx files).</p> <p>As it turns out, the problem related to the fact that they were trying to build a VS2005 sln file.&nbsp; Since the build server didn’t have VS2005 installed on it many of the settings the installer normally creates were present, including the ones that set the paths for the LC.exe.</p> <p>Instead of mucking around with VS2005 solutions, we simply converted it to a VS2008 solution and the LC.exe problem went away.</p> <p>As a note we could have installed VS2005 on the build server as well but since the team was moving to VS2008 anyway the solution conversion option was deemed to be the better choice.</p> <p>However, once we’d done this we ran into another problem.</p> <h3>Strong Naming Shenanigans</h3> <p>The solution being built included a strong named assembly, with the signing processing using a .pfx file instead of the usual .snk file.&nbsp; When the build ran we saw this error message:</p><pre class="brush:csharp">Target ResolveKeySource: <br>C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.Common.targets(1718,7): error MSB4018: The "ResolveKeySource" task failed unexpectedly. <br>C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.Common.targets(1718,7): error MSB4018: System.InvalidOperationException: Showing a modal dialog box or form when the application is not running in UserInteractive mode is not a valid operation. Specify the ServiceNotification or DefaultDesktopOnly style to display a notification from a service application. <br>C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.Common.targets(1718,7): error MSB4018: at System.Windows.Forms.Form.ShowDialog(IWin32Window owner) <br>C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.Common.targets(1718,7): error MSB4018: at System.Windows.Forms.Form.ShowDialog() <br>C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.Common.targets(1718,7): error MSB4018: at Microsoft.Build.Tasks.ResolveKeySource.ResolveManifestKey() <br>C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.Common.targets(1718,7): error MSB4018: at Microsoft.Build.Tasks.ResolveKeySource.Execute() <br>C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.Common.targets(1718,7): error MSB4018: at Microsoft.Build.BuildEngine.TaskEngine.ExecuteTask(ExecutionMode howToExecuteTask, Hashtable projectItemsAvailableToTask, BuildPropertyGroup projectPropertiesAvailableToTask, Boolean&amp; taskClassWasFound) <br>Done building target "ResolveKeySource" in project "xxx.yyy" -- FAILED. </pre><br /><p>Since MSBuild runs non-interactively any time a dialog box appears the build will break (as the dialog box can’t be shown).</p><br /><p>So what was actually happening here to cause a dialog to appear?</p><br /><p>The eagle eyed amongst you will probably have figured it out already, but for those who couldn’t be bothered thinking too much I’ll tell you.&nbsp; As it turns out when you do a compile and sign your assemblies with a .pfx file Visual Studio will look in the local certificate store to see if the certificate is already known.&nbsp; If it’s a certificate that hasn’t been used before then Visual Studio will attempt add it to the local certificate store and in doing so will prompt you to enter the private key as part of the installation process.&nbsp; This is where a dialog box will appear.</p><br /><p>Since this was a new build server the .pfx file obviously hadn’t been seen yet and so Team Build was trying to prompt for the private key so it could install the certificate.</p><br /><p>The solution to this was to simply log on to the build server as the build service account, run the build manually via Visual Studio and enter the private key when prompted.</p><br /><p>Subsequent builds then worked as expected as the certificate was now loaded in the certificate store.</p><br /><p>(Thanks to <a href="http://www.edsquared.com/2007/07/18/Team+Build+And+Strong+Naming+Or+ClickOnce.aspx" target="_blank">Ed Blankenship</a> and his blog for the info on this one)</p>  