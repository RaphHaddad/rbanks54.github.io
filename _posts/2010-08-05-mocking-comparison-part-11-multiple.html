---
layout: post
title: 'Mocking Comparison – Part 11: Multiple Interfaces'
date: '2010-08-05T23:00:00.001+10:00'
author: Richard Banks
tags:
- mocking
modified_time: '2010-08-06T08:57:27.863+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-163983093262748889
blogger_orig_url: http://www.richard-banks.org/2010/08/mocking-comparison-part-11-multiple.html
---

<p>Continuing with our comparison of Rhino Mocks, Moq and NSubstitute we have a look at a little used feature in mocking being the ability to generate mocks that implement multiple interfaces.</p>  <p>Why would you do this though? Well, that’s a good question.&#160; Simple example would be when your class under test expects and object to implement interface X and also implement IDisposable.&#160; It doesn’t happen often, but when it does it’s nice to know the facility is there.</p>  <p>What you’ll see in all the examples is that the mock natively implements a main interface and that to do any interactions with the methods of the second interface requires casting of the mock to that interface.</p>  <p>For the purposes of the code we’re going to pretend that the monkeys of our little zoo are self managing, can act as ZooKeepers and can thus look after themselves.&#160; It’s silly, but it shows the syntax.</p>  <h3>Rhino Mocks</h3>  <p>The thing to note here is that we can’t use GenerateStub here.&#160; We have to use GenerateMock, which then means we don’t get automatically backed properties, so we have to set them up ourselves as well.</p>  <p>   <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:c69c6164-c6d6-4aad-a5b1-63097d94bb31" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Rhino_multiple_interfaces()<br />{<br /> var monkey = MockRepository.GenerateMock&lt;IMonkey, IZooKeeper&gt;();<br /> monkey.Stub(m =&gt; m.Name).PropertyBehavior();<br /> ((IZooKeeper)monkey).Stub(k=&gt; k.AssignedMonkey).PropertyBehavior();<br /><br /> monkey.Name = "Spike";<br /> ((IZooKeeper)monkey).AssignedMonkey = monkey;<br /><br /> Assert.Equal("Spike", ((IZooKeeper)monkey).AssignedMonkey.Name);<br /><br /> Assert.IsAssignableFrom&lt;IMonkey&gt;(monkey);<br /> Assert.IsAssignableFrom&lt;IZooKeeper&gt;(monkey);<br />}</pre></div></p><p>You can also see that we have to cast monkey to IZooKeeper every time we want to do something on the IZooKeeper interface.&#160; Annoying, but that’s the way it goes.</p><h3>Moq</h3><p>The code here is a little different in that we create the mock the normal way, and then add a new interface to it after it’s already created using the .As&lt;T&gt;() method.</p><p>Also, when we set up the property behaviour on the IZooKeeper interface we have to go through some ugly casting and the use of Mock.Get() because of the way Moq separates the Mock and mocked object instances.&#160; Blech.</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:c59eb0c1-abb3-407b-b465-3a3282053ed2" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Moq_multiple_interfaces()<br />{<br /> var monkey = new Mock&lt;IMonkey&gt;();<br /> monkey.As&lt;IZooKeeper&gt;();<br /> monkey.SetupProperty(m =&gt; m.Name);<br /> Mock.Get((IZooKeeper)monkey.Object).SetupProperty(k =&gt; k.AssignedMonkey);<br /><br /> monkey.Object.Name = "Spike";<br /> ((IZooKeeper)monkey.Object).AssignedMonkey = monkey.Object;<br /> <br /> Assert.Equal("Spike", ((IZooKeeper)monkey.Object).AssignedMonkey.Name);<br /><br /> Assert.IsAssignableFrom&lt;IMonkey&gt;(monkey.Object);<br /> Assert.IsAssignableFrom&lt;IZooKeeper&gt;(monkey.Object);<br />}</pre></div><h3>NSubstitute</h3><p>This code is by far the smallest because we don’t need to set up the property behaviours.&#160; It’s uses the same approach as Rhino to create the mock itself, and still has the issues of needing to cast to the IZooKeeper interface, but apart from that it’s once again nice and clean code.</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:d9e575a5-b719-4653-8795-bcca7c46aa8e" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Nsubstitute_multiple_interfaces()<br />{<br /> var monkey = Substitute.For&lt;IMonkey, IZooKeeper&gt;();<br /><br /> monkey.Name = "Spike";<br /> ((IZooKeeper)monkey).AssignedMonkey = monkey;<br /><br /> Assert.Equal("Spike", ((IZooKeeper)monkey).AssignedMonkey.Name);<br /><br /> Assert.IsAssignableFrom&lt;IMonkey&gt;(monkey);<br /> Assert.IsAssignableFrom&lt;IZooKeeper&gt;(monkey);<br />}</pre></div><p>&#160;</p><p>The choice of syntax here is again, quite easy to make.&#160; NSubstitute takes it out.</p><p>This also represents a conclusion to the posts focusing on Rhino Mocks, Moq and NSubstitute in the mocking comparison series.&#160; I’m not quite done though as I want to show some usage scenarios where those frameworks don’t work and where tools like Microsoft Moles and TypeMock fit in, so stay tuned – we’re not quite done yet! :-)</p><p>&nbsp;</p><p>Other posts in this series:<ul><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-1-basics.html">1: The Basics</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-2-properties.html">2: Properties</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-3-interactions.html">3: Interactions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-4-parameter.html">4: Parameter Constraints</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-5-repetitions.html">5: Repetitions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-6-multiple.html">6: Multiple Calls</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-7-exceptions.html">7: Exceptions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-8-recursive.html">8: Recursive Mocks</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-9-functions.html">9: Functions</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-10-events.html">10: Events</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-12-unmockables.html">12: The UnMockables</a></li></ul></p>