---
layout: post
title: How to Build VB6 Apps with TFS Team Build 2010
date: '2010-08-08T22:53:00.001+10:00'
author: Richard Banks
tags:
- TFS
modified_time: '2010-08-08T22:53:00.232+10:00'
thumbnail: http://lh5.ggpht.com/_5dD_rBQSs2o/TFq0MgB0riI/AAAAAAAAA1I/SS1aBNFQr88/s72-c/image_thumb2.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-6778493154019417437
blogger_orig_url: http://www.richard-banks.org/2010/08/how-to-build-vb6-apps-with-tfs-team.html
---

<p>So you’ve got yourself a nice, shiny, new TFS 2010 server and you’re using its build automation features to build your .NET code but you also have some, shall we say it, “legacy” VB6 code laying around that you have to keep alive.&#160; You’ve retired source safe and installed <a title="Get VB6 source control connected to TFS 2010" href="http://visualstudiogallery.msdn.microsoft.com/en-us/bce06506-be38-47a1-9f29-d3937d3d88d6" target="_blank">the MSSCCI provider TFS 2010</a> so TFS is your source repository but now you want the build server to build your VB6 code just like it does for your .NET code.</p>  <p>Here’s how to get VB6 applications built using TFS 2010:</p>  <h3>Preliminary Steps</h3>  <p>1. Go to your build templates folder in source control and make a copy of DefaultTemplate.xaml.&#160; Call it VB6BuildTemplate or something similarly memorable.</p>  <p>2. Open up the new template and find the “Compile the Project” activity sequence.&#160; For reference it’s roughly located in “Compile, Test and Associate Changesets and Work Items” &gt; “Compile and Test” &gt; “Compile and Test for Configuration” &gt; “If BuildSettings.HasProjectsToBuild” &gt; “Compile the Project”</p>  <p>3. Find the “Run MSBuild for Project” activity and delete it.&#160; We’re going to replace that with our own tasks.</p>  <h3>Ensure the Output Directory Exists</h3>  <p>When you that MSBuild activity runs to compile your .NET projects the output locations are created for you automatically but since we’re not using MSBuild we don’t have that luxury for our VB6 compilations so we have to create the folder ourselves.</p>  <p>Start by dragging an “If” Activity into the sequence</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TFq0L8-fw7I/AAAAAAAAA1E/DJIHplVIV-4/s1600-h/image4.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TFq0MgB0riI/AAAAAAAAA1I/SS1aBNFQr88/image_thumb2.png?imgmax=800" width="433" height="262" /></a> </p>  <p>Then drag a CreateDirectory task (from Team Foundation Build Activities) into the “Then” section as shown</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TFq0NN7w0ZI/AAAAAAAAA1M/a9L_chRSLpo/s1600-h/image10.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TFq0NlWLr1I/AAAAAAAAA1Q/bg4Uzq7g7Fw/image_thumb6.png?imgmax=800" width="490" height="318" /></a> </p>  <p>Now the point of this is to check if the outputDirectory has already been created and to create it if it hasn’t.</p>  <p>Set the Condition for the If Activity to: Not System.IO.Directory.Exists(outputDirectory).</p>  <p>Set the Diirectory property of the createDirectory to outputDirectory</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TFq0OQOb47I/AAAAAAAAA1U/3iBZ_fH4PdQ/s1600-h/image15.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TFq0PPtcx2I/AAAAAAAAA1Y/qADtiVxyyWQ/image_thumb9.png?imgmax=800" width="328" height="153" /></a> </p>  <p>For maintainability, rename the activities in the designer as well so that you can better understand what is happening.</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TFq0PvJjQgI/AAAAAAAAA1c/wrL6nvmovig/s1600-h/image20.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TFq0QZ3NFrI/AAAAAAAAA1g/yIE7HHwHTe4/image_thumb12.png?imgmax=800" width="479" height="222" /></a></p>  <p>By the way, if you are sure the directory doesn’t get created earlier in your process then you can drop the if activity and just place the createDirectory activity into the flow directly. </p>  <h3>Ensure a Log Directory Exists</h3>  <p>When we run the VB6 compiler in a build we need to capture the log output to a text file otherwise VB will want to try and open a dialog box telling us there was a compiler problem and want us to click OK. Unfortunately when running unattended, there is no UI and we will never see a window to click the link on.</p>  <p>We’re going to place our log file output in the drop location so that we can easily access it once the build is complete.</p>  <p>Create another if task (or copy/paste) from the previous step and ensure that we use logFileDropLocation instead of outputDirectory.</p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TFq0RKUPgII/AAAAAAAAA1k/LgdwNIyGg9I/s1600-h/image25.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/TFq0RvwFleI/AAAAAAAAA1o/MI5XaDZ8XzI/image_thumb15.png?imgmax=800" width="475" height="227" /></a> </p>  <h3>Call the VB6 Compiler</h3>  <p>Now drag an InvokeProcess activity into the workflow and set it up as follows:</p>  <table border="0" cellspacing="0" cellpadding="2" width="553"><tbody>     <tr>       <td valign="top" width="99">DisplayName</td>        <td valign="top" width="452">VB6 Compiler</td>     </tr>      <tr>       <td valign="top" width="99">FileName</td>        <td valign="top" width="452">Environment.GetFolderPath(Environment.SpecialFolder.ProgramFilesX86) + &quot;\Microsoft Visual Studio\VB98\VB6.exe&quot;</td>     </tr>      <tr>       <td valign="top" width="99">Arguments</td>        <td valign="top" width="452">&quot;/make &quot;&quot;&quot; + localProject + &quot;&quot;&quot; /out &quot;&quot;&quot; + logFileDropLocation + &quot;\vb6.log&quot;&quot; /outdir &quot;&quot;&quot; + outputDirectory + &quot;&quot;&quot;&quot;</td>     </tr>      <tr>       <td valign="top" width="99">Result</td>        <td valign="top" width="452">VB6Result</td>     </tr>   </tbody></table>  <p>&#160;</p>  <p>Note that the VB6Result variable will likely to show up with a warning until you create it as a variable in your workflow. So on the workflow create the variable with a type of Int32 and a scope of “Compile the Project”</p>  <p>If you wish, you can also send stdOutput and errOutput from the InvokeProcess tasks to the build log using the WriteBuildMessage and WriteBuildWarning tasks.&#160; For each of these use the appropriate std/errOutput variables as the values for the Message property, though with the VB6 compiler you’re unlikely to see any messages since we’re sending output to the log file.</p>  <p>The workflow should now look something like this:</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TFq0SFCN4BI/AAAAAAAAA1s/5MAixCFarU0/s1600-h/image31.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TFq0S1ktZwI/AAAAAAAAA1w/NaPBuoY023E/image_thumb19.png?imgmax=800" width="253" height="504" /></a> </p>  <h3>Check the Compiler Result</h3>  <p>Finally we need to check if the compile passed or not.&#160; If it fails we will get a non-zero result back from InvokeProcess </p>  <p>If we don’t check this then the build process just assumes things work and continues on it’s merry way. so add another “If” Activity to the flow and in the Then part add a “Throw” Activity from the Error Handling group.&#160; Set the Throw Activity’s Exception property to “New Exception” and the Condition on the “If” activity to “VB6Result &lt;&gt; 0”.</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TFq0UDcKjuI/AAAAAAAAA10/aieXcCaP_d4/s1600-h/image36.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TFq0UmOQR1I/AAAAAAAAA14/GQ9MErSIBTM/image_thumb22.png?imgmax=800" width="480" height="215" /></a> </p>  <p>Don’t forget to rename the activities to help you diagnose any problems.</p>  <h3>Use It in a Build</h3>  <p>Finally, save your workflow, check it in to source control (in the BuildProcessTemplates folder) and then create a build definition using the new template.</p>  <p>Trigger the build and check the compilation results.&#160; Everything should now work as expected.&#160; Now all you need to do it retire that VB6 code :-)&#160; Good luck with that!</p>