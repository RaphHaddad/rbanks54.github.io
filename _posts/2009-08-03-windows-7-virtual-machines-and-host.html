---
layout: post
title: Windows 7 Virtual Machines and Host Networking
date: '2009-08-03T11:33:00.001+10:00'
author: Richard Banks
tags:
- how to
- microsoft
modified_time: '2009-08-03T11:33:43.975+10:00'
thumbnail: http://lh5.ggpht.com/_5dD_rBQSs2o/SnY-LsfAPKI/AAAAAAAAApE/Pgm1wobsJdc/s72-c/image_thumb%5B7%5D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-7139088698639297287
blogger_orig_url: http://www.richard-banks.org/2009/08/windows-7-virtual-machines-and-host.html
---

<p>Let’s assume you’ve got a Windows 7 Virtual Machine and you want to do networking between the Host and the Guest operating systems with it.</p> <p>I’m going to give you a run through of how I set this up on my laptop using the loopback adapter.&nbsp; There may be other ways, but this works quite well for my needs.</p> <h3>1. Install the Loopback Adapter</h3> <p>Go to device manager (in Control Panel) and select the Add Legacy Hardware option</p> <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/SnY-K9uLmGI/AAAAAAAAApA/fr1Y_ByZQjU/s1600-h/image%5B11%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/SnY-LsfAPKI/AAAAAAAAApE/Pgm1wobsJdc/image_thumb%5B7%5D.png?imgmax=800" width="307" height="218"></a> </p> <p>In the ensuing wizard select: Install manually –&gt; Network Adapters –&gt; Microsoft Loopback Adapter</p> <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/SnY-Mm8rybI/AAAAAAAAApI/0n7_KJ4mf74/s1600-h/image%5B9%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/SnY-N3PC6AI/AAAAAAAAApM/_wbSt6jbmxs/image_thumb%5B5%5D.png?imgmax=800" width="500" height="367"></a> </p> <p></p> <h3>2. Setup the Loopback Adapter</h3> <p>Once the installation is complete we need to configure the loopback adapter.&nbsp; My preference is to use fixed IP addresses for this so that I can use machine names to identify the VM easily, just make sure you pick an address range that isn’t used :-)</p> <p>So go to the Networking and Sharing Center and select “Change Adapter Settings” on the left. You should see something like this:</p> <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/SnY-O5ZGvNI/AAAAAAAAApQ/1ZQ2AZbGseg/s1600-h/image%5B14%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/SnY-Pwq5qxI/AAAAAAAAApU/STkYYb9j720/image_thumb%5B8%5D.png?imgmax=800" width="322" height="308"></a> </p> <p>Now go to the Loopback Adapters properties and then go to the properties of the IPv4 TCP/IP settings:</p> <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/SnY-Qn7gaRI/AAAAAAAAApY/KpAC7hBKY6Y/s1600-h/image%5B20%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/SnY-R6rjyTI/AAAAAAAAApc/7OWjvLut4AA/image_thumb%5B12%5D.png?imgmax=800" width="504" height="497"></a> </p> <p>Simply set the IP address you wish to use for communicating with the VM.&nbsp; I normally use a 10.x.x.x address range with the Class C subnet to minimise conflicts with other networks I may be connected to.</p> <p>Not that I normally disable the IPv6 settings on the loopback adapter to make the configuration simpler.</p> <p></p> <h3>3. Configure the Virtual Machine Networking</h3> <p>Assuming you already have a virtual machine configured you now need to go to your virtual machines settings and set up the networking as follows:</p> <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/SnY-SYm0chI/AAAAAAAAApg/5uHMONVw8H0/s1600-h/image%5B29%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/SnY-TREbeZI/AAAAAAAAApk/lWG54yaPqgM/image_thumb%5B17%5D.png?imgmax=800" width="504" height="339"></a> </p> <p>Set adapter 1 to be the loopback adapter and adapter 2 to be your physical network adapter so that I can access the internet and other networks from the VM should I need to.</p> <h3>4. Configure the VM’s Operating System</h3> <p>Now we need to start the VM and change some settings in the networking to use the fixed IP for the loopback adapter in much the same way as we did for the Host Operating System.</p> <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/SnY-UhqBqqI/AAAAAAAAApo/eyjyIrFzt5o/s1600-h/image%5B28%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/SnY-WCKz-6I/AAAAAAAAAps/Hf1vrrmk0R0/image_thumb%5B16%5D.png?imgmax=800" width="504" height="524"></a> </p> <p>You may notice that in the network adapters it’s hard to tell which adapter is which since they are all the same type (i.e. the virtualised network).&nbsp; The trick is to remember which network adapter is which in the VM settings – Adapter 1 is “Local Area Connection”, Adapter 2 is “Local Area Connection 2”, etc.</p> <h3>5. Don’t Forget Your Firewalls</h3> <p>So if we were to try pinging the Host OS from the VM we would probably find we don’t get a response, and the same would happen if we did it the other way around.&nbsp; If that’s the case you probably forgot to adjust your firewall settings.</p> <p>Here’s how it’s done in Windows 7 on the Host:</p> <p>Go to Control Panel –&gt; Windows Firewall then choose “Advanced Settings”</p> <p>Select the Inbound Rules from the left side and then choose the New Rule action from the right.</p> <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/SnY-W_NycuI/AAAAAAAAApw/gM4QkGRYwEQ/s1600-h/image%5B33%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/SnY-YDrbFeI/AAAAAAAAAp0/IoMozWLU0SM/image_thumb%5B19%5D.png?imgmax=800" width="504" height="344"></a> </p> <p></p> <p></p> <p>Choose “Custom” in the dialog and then in the scope step add the IP address for the VM in the Remote settings area (as shown).&nbsp; For extra security you should also ensure that the local address is set to the IP address of the loopback adapter on the host (10.2.1.1 in my case).</p> <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/SnY-ZL1rniI/AAAAAAAAAp4/LfiOvOE3sDg/s1600-h/image%5B40%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/SnY-aHBq-nI/AAAAAAAAAp8/YSvEkLTQxls/image_thumb%5B22%5D.png?imgmax=800" width="504" height="407"></a> </p> <p>Allow all connections through on that rule and don’t forget to give it a meaningful name such as “Windows VM Loopback” or something like that.</p> <p>You’ll also need to do that same in your guest operating system (assuming it also has a firewall enabled).</p> <p>Once that’s done you should then be able to ping the Host from the VM as shown and do the same in the reverse direction.</p> <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/SnY-a1I50II/AAAAAAAAAqA/xiNc1lT9OXE/s1600-h/image%5B41%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/SnY-brzJn3I/AAAAAAAAAqE/fie92t5N78w/image_thumb%5B23%5D.png?imgmax=800" width="504" height="265"></a> </p> <h3>6. One Last Step</h3> <p>Trying to use IP addresses can be somewhat of a pain, especially if something you’re accessing is wanting you to use host names instead.&nbsp; The way to improve this situation is to edit the HOSTS file and add entries for the remote machines in both the Host OS and also in the Guest OS (the VM).</p> <p>On Windows 7 start Notepad as Administrator since you need Administrator privileges to edit the HOSTS file.&nbsp; The Hosts file can be found in C:\Windows\System32\drivers\etc.&nbsp; Note that there is no extension on the Hosts file so you may have to change the filter in the Open File dialog to show all files before you’ll see it.</p> <p>Once you have it open add an entry at the end of the file on a new line in the format of &lt;ip address&gt; &lt;machine name&gt;.&nbsp; For example I use:<br><font face="cou">10.2.1.2&nbsp;&nbsp;&nbsp; tfs2008-vm</font></p> <p>Save the file and check that things are working by opening up a command prompt and pinging the virtual machine using the name you just gave it:</p> <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/SnY-cp4bzeI/AAAAAAAAAqI/uT69C0fHa14/s1600-h/image%5B45%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/SnY-dljsp4I/AAAAAAAAAqM/3Ygn5HUeFKU/image_thumb%5B25%5D.png?imgmax=800" width="504" height="273"></a> </p> <p>Don’t forget to do the same on the Guest OS in the Virtual Machine.</p> <p>Once that’s done you should be all set to go and your Windows 7 Host and you Virtual Machine should now be able to talk to each other without a problem.</p> <p>Enjoy!</p>  