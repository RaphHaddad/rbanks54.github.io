---
layout: post
title: TFS11 and Source Control Improvements
date: '2011-09-19T08:58:00.001+10:00'
author: Richard Banks
tags:
- TFS
modified_time: '2011-09-19T08:58:13.150+10:00'
thumbnail: http://lh4.ggpht.com/-IKqpcE_Hlas/TnZ3YKs1N4I/AAAAAAAABNo/Egjc3Ebdo7o/s72-c/clip_image002_thumb%25255B1%25255D.jpg?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-4346527285931481510
blogger_orig_url: http://www.richard-banks.org/2011/09/tfs11-and-source-control-improvements.html
---

<p>Now that build is over and we have a Visual Studio 11 we can finally play with I’ve had a brief look at how local workspaces work.</p>  <p>For those who aren’t aware, local workspaces finally removes the number 1, most annoying “feature” in TFS and that is the server-side source control model.</p>  <p>This is the approach where the server keeps track of what it thinks you have on your local development machine and where all checkin/checkout operations require communication with the server making offline work very difficult, and where you can’t make local changes to checked out files because the server wouldn’t be aware of them so all files under source control have the read only bit set.&#160; It’s a major pain.</p>  <p>Now there are valid reasons for this approach related to managing VERY large source repositories (think multi-GB of source) and it’s still possible to use server-managed work spaces if desired, but for the 99% of us that just don’t deal with that sort of volume this is a feature we just don’t need.&#160; TFS 11 sees the introduction of a subversion style approach to source control with the introduction of local workspaces.&#160; Before you get too excited, remember that a local workspace is not a DVCS and TFS doesn’t feature one yet.&#160; That said, Brian Harry in a recent post about source control improvements in TFS11 said the following (emphasis mine):</p>  <blockquote>   <p><em>I’m certain that about this time, I bunch of people are asking “but, did you implement DVCS”. The answer is no, not yet. You still can’t checkin while you are offline. And you can’t do history or branch merges, etc. Certain operations do still require you to be online. You won’t get big long hangs – but rather nice error messages that tell you you need to be online. <strong>DVCS is definitely in our future</strong> and this is a step in that direction but there’s another step yet to take.</em></p> </blockquote>  <p>There’s also a number of suggestions about source control on the <a href="http://visualstudio.uservoice.com/">Visual Studio User Voice site</a> that you may want to vote on so that the team makes this a priority, for example <a href="http://visualstudio.uservoice.com/forums/121579-visual-studio/suggestions/2037673-allow-the-version-control-system-to-be-pluggable">Allow the version control system to be pluggable</a>, or you can create one specifically for a TFS DVCS feature.</p>  <p>Anyway, let’s have a look at a few things in the new developer preview.</p>  <h3>What’s on our disk after doing a Get Latest?</h3>  <p>Firstly, we see we now have a hidden folder in our workspace root</p>  <p><a href="http://lh4.ggpht.com/-Rb3Nz69KV-g/TnZ3XR8kiJI/AAAAAAAABNk/o5T4toGriDI/s1600-h/clip_image002%25255B4%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image002" border="0" alt="clip_image002" src="http://lh4.ggpht.com/-IKqpcE_Hlas/TnZ3YKs1N4I/AAAAAAAABNo/Egjc3Ebdo7o/clip_image002_thumb%25255B1%25255D.jpg?imgmax=800" width="523" height="226" /></a></p>  <p>The folder itself contains a bunch of child folders, which are oddly reminiscent of sourcesafe.&#160; Thankfully it’s not!   <br /><a href="http://lh3.ggpht.com/-gFk1zWYYMIo/TnZ3YzxJbSI/AAAAAAAABNs/GV3qnAmc4Vg/s1600-h/clip_image004%25255B4%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image004" border="0" alt="clip_image004" src="http://lh4.ggpht.com/-x5w3mLLA8IE/TnZ3Z46mGwI/AAAAAAAABNw/VSrJw_W4Gs0/clip_image004_thumb%25255B1%25255D.jpg?imgmax=800" width="634" height="445" /></a></p>  <p>These folders course contain GUID based file names:   <br /><a href="http://lh6.ggpht.com/-lv2uH7lAP_8/TnZ3aqalmLI/AAAAAAAABN0/jsfP5V0PDZ8/s1600-h/clip_image006%25255B5%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image006" border="0" alt="clip_image006" src="http://lh3.ggpht.com/-9-SdSWQ_CQ4/TnZ3bhxGvRI/AAAAAAAABN4/9sjiXt33uNU/clip_image006_thumb%25255B2%25255D.jpg?imgmax=800" width="634" height="445" /></a></p>  <p>And each of those files are simply GZipped copies of your individual source files. Opening them with 7Zip reveals the source files&#160; just as you would expect.&#160; Obviously you should leave all this alone and not touch it but it’s interesting nonetheless (or at least it is for me!)</p>  <h3>Local Source Control Operations</h3>  <p>So leaving that aside, what happens when we make file system changes outside of Visual Studio?</p>  <p>To find out I did a simple copy/paste of a few files and renamed a view in an MVC3 project.&#160; This is what pending changes shows (the other changes are from the VS11 project upgrade)</p>  <p><a href="http://lh5.ggpht.com/-WHYVyF1yfUw/TnZ3cU7J-XI/AAAAAAAABN8/howIpfGJUqE/s1600-h/clip_image008%25255B4%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image008" border="0" alt="clip_image008" src="http://lh5.ggpht.com/-2BFGdMnJOBw/TnZ3dEcW8lI/AAAAAAAABOA/4dQ1Sea65UY/clip_image008_thumb%25255B1%25255D.jpg?imgmax=800" width="289" height="491" /></a></p>  <p>So the changes are detected but are currently marked as ignored for now.&#160; I get why the copied files are excluded, because they aren’t part of the solution, but I wasn’t sure why the rename was ignored until I realised it had happened because the files I’d chosen were from an MVC3 project and I hadn’t updated VS11 to support MVC3 apps as yet.&#160; This mean Visual Studio hadn’t actually loaded the project so wasn’t actively tracking the file that was renamed.</p>  <p>If I click the “Detected changes (5)” link, we see this:</p>  <p><a href="http://lh4.ggpht.com/-xD11Mgko0MM/TnZ3dkZjsII/AAAAAAAABOE/ZPGDPF0xoyI/s1600-h/clip_image010%25255B4%25255D.gif"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image010" border="0" alt="clip_image010" src="http://lh5.ggpht.com/-UkqWHbbcDwQ/TnZ3ebYJ5jI/AAAAAAAABOI/mrS_JwLbJ8I/clip_image010_thumb%25255B1%25255D.gif?imgmax=800" width="549" height="361" /></a></p>  <p>You’ll note that the rename detection isn’t happening in the developer preview though I expect a way to mark add/delete pairs as renames will be provided before RTM.&#160; We also have a “promote” button to turn the excluded changes into included ones.&#160; Pretty simple.&#160; You can also right click files to ignore them (such as upgrade reports, backup folders, etc) so that they don’t constantly sit in the “excluded files” list. </p>  <p>Once we include the files we want, we see this:</p>  <p><a href="http://lh3.ggpht.com/-39mLnRGVSzg/TnZ3e6pluII/AAAAAAAABOM/YVFA70lGb4o/s1600-h/clip_image012%25255B4%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image012" border="0" alt="clip_image012" src="http://lh4.ggpht.com/--f9Z-1qzk0I/TnZ3fiNvzVI/AAAAAAAABOQ/ADfmYV4vN90/clip_image012_thumb%25255B1%25255D.jpg?imgmax=800" width="272" height="324" /></a></p>  <p>Nice.&#160; Now, when we’re offline we can’t check in with a local workspace.&#160; We have to be connected.&#160; When we are, we can click the Check In button and we’ll get a notification message with a link to the Changeset we just added</p>  <p><a href="http://lh5.ggpht.com/-DFsqGRmEtr0/TnZ3gEU-7DI/AAAAAAAABOU/cP9neTxuhGM/s1600-h/clip_image014%25255B4%25255D.jpg"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="clip_image014" border="0" alt="clip_image014" src="http://lh3.ggpht.com/-h4Rz2oZn8K0/TnZ3gzF5-tI/AAAAAAAABOY/SLMn2esyxxc/clip_image014_thumb%25255B1%25255D.jpg?imgmax=800" width="304" height="227" /></a></p>  <h3>Local Exclusions</h3>  <p>In git, mercurial and other source control systems there are usually configuration files to control the files that source control will ignore (i.e .gitignore and .hgignore) and they are located in the same folder as the source itself so that they can be checked in and shared across all team members.</p>  <p>In TFS there is only one global exclusion file, and it contains all your local exclusions.&#160; It lives in C:\Users\Me\AppData\Local\Microsoft\Team Foundation\4.0\Configuration\VersionControl\LocalItemExclusions.config and looks something like this:</p>  <p>&#160;&#160;&#160; &lt;UserExclusions&gt;   <br />&#160;&#160;&#160;&#160;&#160; &lt;Exclusion&gt;c:\temp\tfspreview\scrum project\Trunk\DemoAppSolution\UpgradeLog.XML&lt;/Exclusion&gt;    <br />&#160;&#160;&#160;&#160;&#160; &lt;Exclusion&gt;c:\temp\tfspreview\scrum project\Trunk\DemoAppSolution\_UpgradeReport_Files&lt;/Exclusion&gt;    <br />&#160;&#160;&#160;&#160;&#160; &lt;Exclusion&gt;c:\temp\tfspreview\scrum project\Trunk\DemoAppSolution\Backup&lt;/Exclusion&gt;    <br />&#160;&#160;&#160; &lt;/UserExclusions&gt;</p>  <p>I’d prefer a local exclusion file (e.g. a .$tfsignore) to live at the solution or workspace root and I’d also prefer it to be glob or regex syntax instead of and XML document, but at least we have something. It’s a start.</p>  <p>Finally, if you want to play with local workspaces you’ll need access to a TFS11 server.&#160; The hosted TFS preview service works well for this and if you try doing source control operations over a 3g connection you <i>really</i> feel the difference between local operations and server calls.&#160; Alternatively you can download the TFS11 developer preview from MSDN subscriber downloads and install your own TFS server to have a play with.</p>  <p>All up, this is a well overdue improvement in source control and should alleviate some of the pain we all feel when dealing with TFS.</p>  