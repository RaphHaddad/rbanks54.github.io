---
layout: post
title: Detecting Duplicate Code
date: '2008-02-11T14:06:00.001+11:00'
author: Richard Banks
tags:
- readify
- tools
- development
modified_time: '2008-02-11T14:06:15.242+11:00'
thumbnail: http://lh5.google.com/rbanks54/R6-7iQYcKKI/AAAAAAAAAPI/Vs2n9gxgUdY/s72-c/ccfinder2_thumb%5B2%5D
blogger_id: tag:blogger.com,1999:blog-13321238.post-3093742464152857250
blogger_orig_url: http://www.richard-banks.org/2008/02/detecting-duplicate-code.html
---

<p>I’ve recently stumbled across a tool that detects <a href="http://en.wikipedia.org/wiki/Duplicate_code">duplicate code</a> (aka code clones) called CCFinder.&nbsp; It’s definitely not the simplest thing in the world to download and install, and it’s a little bit painful to exclude generated files (it has to be done manually) but it does do make finding repeated code a lot easier than with a tool like Simian.&nbsp; Why?&nbsp; Because you get a visual indication of where the duplicates are and can see the code itself.&nbsp; Plus you have greater control over the rules used to detect duplication of code.  <p>Now before I run through things, it should be noted that I’d expect to see some level of "detected duplication" in any non-trivial code base.&nbsp; There are often scenarios where one part of the code will have a similar structure to other parts even though they're performing different functions or you'll have generated code or have situations where avoiding duplication adds more complexity than it is worth.&nbsp; Even so, the amount of duplication detected in any code base should be kept as small as possible as it keeps your code maintainable and means that fixes and changes only need to be made once.&nbsp; There's nothing worse than fixing a bug in one part of the code, not realising the same code actually exists elsewhere and also needs fixing.  <p>To give you an idea of what CCFinder shows have a look at the following screen shots:  <p>This first picture is showing code clone metrics per file and a visual indication of where the code clones are.  <p>In the left panel (the file listing) various metrics are shown per file:  <ul> <li><strong>LEN:</strong> File length (in tokens – variable names, method calls, etc)  <li><strong>CLN:</strong> Number of Code Clones  <li><strong>NBR:</strong> Neighbors – Number of other files that share a code clone in this file  <li><strong>RSA:</strong> Ratio of Similarity to another file.&nbsp; Lower is better.  <li><strong>RSI:</strong> Ratio of Similarity within the file. Lower is better.  <li><strong>CVR:</strong> Coverage – Percentage of tokens covered by another code clone (and indication of how much of the code is duplicated)</li></ul> <p>In the right hand panel we have a visual indicator of where the clones are.&nbsp; The long diagonal line can be thought of as a mirror line and the black marks on each side of that diagonal are the clones.&nbsp; The large boxes are directory boundaries, so we can see which directories have more duplication than others.  <p><a href="http://lh4.google.com/rbanks54/R6-7hAYcKJI/AAAAAAAAAPA/tgGqXUV5WtU/ccfinder2%5B4%5D"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="457" alt="ccfinder2" src="http://lh5.google.com/rbanks54/R6-7iQYcKKI/AAAAAAAAAPI/Vs2n9gxgUdY/ccfinder2_thumb%5B2%5D" width="644" border="0"></a>  <p>We can also use Source view to see the duplicates between files.&nbsp;&nbsp; For example this shows a SetDateLabel() method in two different files where the code only differs by the parameter being called.&nbsp; It would be a great refactoring candidate.  <p>If it's not obvious the section between the file listing and the code windows is a visual indicator of which file sections the two source windows are showing, and where the duplicated code is within those files.  <p><a href="http://lh5.google.com/rbanks54/R6-7kQYcKLI/AAAAAAAAAPQ/RcrUgrPjzcs/ccfinder5%5B3%5D"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="484" alt="ccfinder5" src="http://lh5.google.com/rbanks54/R6-7mQYcKMI/AAAAAAAAAPY/pjTdpCyvp7c/ccfinder5_thumb%5B1%5D" width="636" border="0"></a>  <p>You can also see code clones within the same file as well:  <p><a href="http://lh3.google.com/rbanks54/R6-7nwYcKNI/AAAAAAAAAPg/KhK0ZPdPHvs/ccfinder4%5B4%5D"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="484" alt="ccfinder4" src="http://lh5.google.com/rbanks54/R6-7pQYcKOI/AAAAAAAAAPo/zbS6FX3mWWo/ccfinder4_thumb%5B2%5D" width="636" border="0"></a>  <p>I've only used it for a short while, but I'm finding it to be very, very useful.&nbsp; If you can work through the crappy web site and the awful download/registration process hopefully you'll find it just as useful.  <p>If you want the software, it’s free but you will need to register to get a license.&nbsp; Go to <a href="http://www.ccfinder.net/index.html">http://www.ccfinder.net/index.html</a> and download it from there.</p>  