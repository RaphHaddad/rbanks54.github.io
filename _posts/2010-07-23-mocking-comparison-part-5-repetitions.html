---
layout: post
title: 'Mocking Comparison - Part 5: Repetitions'
date: '2010-07-23T13:23:00.002+10:00'
author: Richard Banks
tags:
- mocking
modified_time: '2010-08-06T08:55:14.565+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-3901415120483279569
blogger_orig_url: http://www.richard-banks.org/2010/07/mocking-comparison-part-5-repetitions.html
---

<p>In <a title="Parameter Constraints" href="http://www.richard-banks.org/2010/07/mocking-comparison-part-4-parameter.html" target="_blank">Part 4</a> we looked at how parameter constraints are handled and in <a title="Interactions" href="http://www.richard-banks.org/2010/07/mocking-comparison-part-3-interactions.html" target="_blank">Part 3</a> we looked at how to do interaction based tests with mocks.&#160; In this part we bring those two pieces together and add a little extra to check if a call was made a specific number of times.</p>  <p>Let’s just jump straight into the code shall we?</p>  <h3>Rhino Mocks</h3>  <p>Our test here is simply going to call a method a number of times and verify that the call was made the correct number of times using constraints to verify the correct calls.&#160; It’s a completely useless test, other than as a vehicle to show you how to do this sort of thing</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:b9618701-6388-48c5-a4c1-4f8bd35d2550" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Rhino_repetitions()<br />{<br /> var monkey = MockRepository.GenerateMock&lt;IMonkey&gt;();<br /><br /> monkey.TryAddFleas(5);<br /> monkey.TryAddFleas(-1);<br /> monkey.TryAddFleas(9);<br /><br /> monkey.AssertWasCalled(m =&gt; m.TryAddFleas(0),<br />  options =&gt; options.Constraints(<br />   Is.GreaterThan(3) &amp;&amp; Is.LessThanOrEqual(10)<br />  )<br />  .Repeat.Twice());<br /> monkey.AssertWasCalled(m =&gt; m.TryAddFleas(-1),<br />  options =&gt; options.Repeat.Once());<br />}<br /></pre></div><p>Note the important part, the .Repeat.Twice() and .Repeat.Once() calls.&#160; It’s these calls that define our expectations as to how many times the call should have been made.</p><p>Rhino also features a .Repeat.Time(n) call you can use as well if once or twice don’t cut it for you.</p><h3>Moq</h3><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:0b6c9fa2-e577-4261-bd1e-cb122842b6f9" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Moq_repetitions()<br />{<br /> var monkey = new Mock&lt;IMonkey&gt;();<br /><br /> monkey.Object.TryAddFleas(5);<br /> monkey.Object.TryAddFleas(-1);<br /> monkey.Object.TryAddFleas(9);<br /><br /> monkey.Verify(m =&gt; m.TryAddFleas(<br />   It.IsInRange(3,10,Range.Exclusive)<br />  ),<br />  Times.Exactly(2));<br /> monkey.Verify(m =&gt; m.TryAddFleas(-1), Times.Once());<br />}</pre></div><p>Instead of using the word Repeat, Moq uses Times.&#160; Apart from that there is little difference.</p><h3>NSubstitute</h3><p>Unfortunately NSubstitute doesn’t support this feature yet as it’s still a maturing framework.&#160; If you really need to do this type of testing then you’ve got a few options – use Rhino or Moq, contribute to the NSubstitute project, or to just not do this type of testing :-).</p><p>Interaction based testing is valid at times, but it’s generally brittle and is usually a sign of “implementation verifying” tests rather than behaviour/specification verifying tests (but that’s an argument for another time)</p><p>&#160;</p><p>Verdict: Moq wins out in this case simply because it’s constraint system is more terse than the Rhino one, but this is purely a personal taste thing.</p><p>&nbsp;</p><p>Other posts in this series:<ul><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-1-basics.html">1: The Basics</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-2-properties.html">2: Properties</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-3-interactions.html">3: Interactions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-4-parameter.html">4: Parameter Constraints</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-6-multiple.html">6: Multiple Calls</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-7-exceptions.html">7: Exceptions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-8-recursive.html">8: Recursive Mocks</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-9-functions.html">9: Functions</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-10-events.html">10: Events</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-11-multiple.html">11: Multiple Interfaces</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-12-unmockables.html">12: The UnMockables</a></li></ul></p>