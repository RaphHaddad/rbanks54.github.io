---
layout: post
title: 'How To: In Place Branch Switching with TFS 2010'
date: '2011-03-28T12:39:00.001+11:00'
author: Richard Banks
tags:
- TFS
modified_time: '2011-03-28T12:39:29.697+11:00'
thumbnail: http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mU_zIehI/AAAAAAAABAE/f02wdkx1Jc8/s72-c/image_thumb%5B26%5D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-5977254732777513937
blogger_orig_url: http://www.richard-banks.org/2011/03/how-to-in-place-branch-switching-with.html
---

<p>One of the nice features of some of the newer version control systems is the ability to do fast in-place branch switching.</p>  <p>This is really useful when you are working on a web application and you have mapped an IIS virtual directory to your source folder and want to switch between branches without having to reconfigure your IIS mappings.</p>  <p>If you’re using TFS then most likely branch switching is a pain because you have branches mapped to separate folders and have to constantly close the solution, remap IIS and open the solution again from the other branch folder.&#160; But you don’t have to! You can actually have multiple branches using the same local working folder, just not at the same time.</p>  <p>Here’s how to do in place branch switching with TFS 2010.</p>  <h2>Starting Point</h2>  <p>Let’s assume we have the following source tree in TFS, with a <a href="http://www.richard-banks.org/2011/02/branch-per-story-pattern-and-tfs.html">branch per story</a> arrangement (this is using Source Control Explorer in Visual Studio 2010).&#160; We currently have no branches mapped, thus the grey folders.</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mUO9cNkI/AAAAAAAABAA/aJptIeTLV3M/s1600-h/image%5B76%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mU_zIehI/AAAAAAAABAE/f02wdkx1Jc8/image_thumb%5B26%5D.png?imgmax=800" width="230" height="183" /></a></p>  <p>Let’s now map the integration branch and then get the source locally to our working folder.</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TY_mVZRkWWI/AAAAAAAABAI/mbncmc4Mu1s/s1600-h/image%5B80%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mWE1vY8I/AAAAAAAABAM/JujiVRuyB0E/image_thumb%5B30%5D.png?imgmax=800" width="480" height="146" /></a></p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TY_mW-jncfI/AAAAAAAABAQ/IWj461fsliU/s1600-h/image%5B81%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mXtTmanI/AAAAAAAABAU/pOzBGzwUxeg/image_thumb%5B31%5D.png?imgmax=800" width="487" height="199" /></a></p>  <p>When we look at the workspace details we then see this:</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TY_mYJBBqOI/AAAAAAAABAY/WW5BcVgAVok/s1600-h/image%5B83%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mZKn_XSI/AAAAAAAABAc/0dTvUneGFKY/image_thumb%5B33%5D.png?imgmax=800" width="480" height="390" /></a></p>  <h2>Switching Branches In Place</h2>  <p>Now let’s say I want to switch to one of my story branches to make some changes.&#160; The easiest way is right click the folder in source control and select “Map to Local Folder”</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TY_mZ1yexNI/AAAAAAAABAg/IEyjKkKtQBk/s1600-h/image%5B95%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/TY_masPIH1I/AAAAAAAABAk/Le0MIVzqgxo/image_thumb%5B41%5D.png?imgmax=800" width="118" height="240" /></a></p>  <p>Alternatively, if you have the power tools installed into VS2010, you could click on the path mapping at the top of the source control explorer window:</p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TY_mbUJxMYI/AAAAAAAABAo/QDl2ABRA1t4/s1600-h/image%5B102%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TY_mcVpAHFI/AAAAAAAABAs/pJ6H8MkyKtk/image_thumb%5B48%5D.png?imgmax=800" width="484" height="274" /></a></p>  <p>We then enter the same working folder that we used for the integration branch above.&#160; Given we’re wanting to reuse our working folder this should be obvious.</p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TY_mdBHOi3I/AAAAAAAABAw/tDKRRKD_dOU/s1600-h/image%5B99%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mdrctGoI/AAAAAAAABA0/eNYGoNkOggg/image_thumb%5B45%5D.png?imgmax=800" width="480" height="146" /></a></p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TY_medVd_eI/AAAAAAAABA4/AKO2R9FAbtQ/s1600-h/image%5B100%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mfPzoLEI/AAAAAAAABA8/WoJOa1eWYrk/image_thumb%5B46%5D.png?imgmax=800" width="487" height="199" /></a></p>  <p>If we now look at source control explorer we’ll see that the integration branch is no longer mapped (it’s greyed out) and that our 2703 story is now the active branch.</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mfwC8-1I/AAAAAAAABBA/LkGgbdqvHOM/s1600-h/image%5B104%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mgZ-6dfI/AAAAAAAABBE/WH1gkjMRc7Q/image_thumb%5B50%5D.png?imgmax=800" width="232" height="202" /></a></p>  <p>We can confirm this by looking at the workspace details, seeing that the integration branch is no longer mapped and that our story branch is set to the working folder.</p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TY_mhLy6FtI/AAAAAAAABBI/Y1W5VdjvvlQ/s1600-h/image%5B107%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_miP__s3I/AAAAAAAABBM/V9hwpif8SdU/image_thumb%5B53%5D.png?imgmax=800" width="480" height="390" /></a></p>  <p>Note that if you change the source control folder in the working folders section of the workspace dialog you will also trigger the remapping operation.</p>  <p>When the get operation executes to pull down files, TFS will only send you files that are different between the two branches. It’s not a full recursive get, which means this operation is quite fast.</p>  <p>Note that this only works if we are switching between TFS branches.&#160; If you try switching between non-branch folders you’ll get an error indicating the folder is already mapped.</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mi3sp2FI/AAAAAAAABBQ/Wcxm9bP4oEM/s1600-h/image%5B109%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mjS2bv_I/AAAAAAAABBU/5cbKL1A3IMM/image_thumb%5B55%5D.png?imgmax=800" width="489" height="199" /></a></p>  <h2>Command Line Goodness</h2>  <p>OK, so let’s go and switch back to the integration branch but this time we’ll do it via the command line.&#160; We need two commands for this:</p>  <p><strong>tf workfold /map </strong>&lt;&lt;&lt; to change the workspace folder mapping</p>  <p><strong>tf get /remap</strong> &lt;&lt;&lt; to bring the local folder contents up to date</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mkFubb2I/AAAAAAAABBY/L60QphCXQLk/s1600-h/image%5B110%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/TY_mkpAEa6I/AAAAAAAABBc/KhFwJqpJx_w/image_thumb%5B56%5D.png?imgmax=800" width="532" height="194" /></a></p>  <p>And as you can see TFS 2010 has only given us the files that are different between the branches.&#160; Nice.</p>  <p>Now, you may ask, why would I use this method and not do it all via Visual Studio 2010?</p>  <p>Well, firstly it’s faster to do it this way (at least for me it is), plus it’s very easy to create a small batch file to make this even quicker and simpler, but a more pragmatic reason is that if I have a solution open when branch switching occurs then you’ll see this in Visual Studio 2010:</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TY_mlDX5XLI/AAAAAAAABBg/2gF8Sr0OdbQ/s1600-h/image%5B112%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mlidiisI/AAAAAAAABBk/zTIJdCXHs2Q/image_thumb%5B58%5D.png?imgmax=800" width="447" height="171" /></a></p>  <p>Which means I have to wait for the solution to close, for the get operation to complete and then I have to manually reopen the solution.&#160; It’s easier than closing the solution in one folder and reopening the solution from another folder, but it’s still somewhat annoying.</p>  <p>If on the other hand I do the branch remapping from the command line then I simply get this:</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mmQcPUUI/AAAAAAAABBo/rdljzH9AU9M/s1600-h/image%5B115%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mnjFWQpI/AAAAAAAABBs/Uu3nuTiKJf8/image_thumb%5B61%5D.png?imgmax=800" width="480" height="164" /></a></p>  <p>Visual Studio just prompts to reload open files that have changed, which makes the switching process much easier since I only can just click yes to all and be done.&#160; Note that if project or solution files have changed you’ll be prompted to reload them, but there’s no simple way around this.</p>  <p>Oh, one other reason for the command line usage is that at times Visual Studio gets confused about the workspace mapping changes and can sometimes block the switch by showing the “already mapped” error we saw earlier.&#160; The command line has no such problems that I’ve seen.</p>  <h2>Hang On! What If We Have Pending Changes?</h2>  <p>Fair enough.&#160; Let’s see what happens.</p>  <p>Assume we’re currently on the integration branch and that we have edited a file.&#160; The pending changes window shows this pending edit.</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mosSZRrI/AAAAAAAABBw/ay7qffcEm2o/s1600-h/image%5B119%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mpRP75KI/AAAAAAAABB0/1nW6aX0ah58/image_thumb%5B65%5D.png?imgmax=800" width="484" height="173" /></a></p>  <p>If we now switch to the story branch we get a conflict:</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mqPFPX1I/AAAAAAAABB4/yyHOFrQEULw/s1600-h/image%5B121%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mqyxwTpI/AAAAAAAABB8/lcliO-2WoQM/image_thumb%5B67%5D.png?imgmax=800" width="484" height="196" /></a></p>  <p>So at this point we do the obvious and click “Checkout File and AutoMerge”, right?&#160; Well, not so fast!</p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TY_mro4EKxI/AAAAAAAABCA/HoULa8LTOzs/s1600-h/image%5B123%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TY_msYT0qqI/AAAAAAAABCE/o9dFtA4ylCU/image_thumb%5B69%5D.png?imgmax=800" width="347" height="214" /></a></p>  <p>This is because the file hasn’t been downloaded to our workspace yet (remember we’re switching our workspace around). Here’s what we see in source control explorer if we want proof:</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mt1UkdYI/AAAAAAAABCI/5l3SqJ49mQE/s1600-h/image%5B125%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TY_muhS3DKI/AAAAAAAABCM/AR0Jyc451XU/image_thumb%5B71%5D.png?imgmax=800" width="484" height="88" /></a></p>  <p>I’d much rather the pending changes window didn’t show the unusable option, but that aside, we grudgingly take the only choice available to us and overwrite the local file.&#160; Our changes are wiped out and the file is now exactly as it is in the story branch we just switched to.</p>  <p>At this point if we look at the pending changes window we see this…</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mvO8zr_I/AAAAAAAABCQ/4rNfxVdZxbQ/s1600-h/image%5B126%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TY_mwLAIq0I/AAAAAAAABCU/dFsMxSBDO6o/image_thumb%5B72%5D.png?imgmax=800" width="484" height="181" /></a></p>  <p>Huh? What’s up with that? TFS is saying there’s a pending change on our file that we just overwrote, but this is the pending change for our original branch isn’t it?&#160; If we check in at this point would we make a mess in our original branch.&#160; Urgh!</p>  <p>What if we now didn’t look and we went and edited EngineTest.cs in our story branch?&#160; If we do and we refresh the pending changes window we see this:</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mwhP99-I/AAAAAAAABCY/dTwNbZjRtzo/s1600-h/image%5B127%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mxZL6L0I/AAAAAAAABCc/oGqcQbcBilw/image_thumb%5B73%5D.png?imgmax=800" width="484" height="168" /></a></p>  <p>Ah! So the refresh of pending changes shows that we not only have a change in our current story branch but that we also have a pending change for the integration branch still hanging around, but that the integration branch change isn’t mapped to a local file.</p>  <p>I should probably check that integration change in so things don’t get confusing.&#160; If we switch back to the integration branch, what happens?&#160; Why, we get a merge conflict of course!</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_mxwyY05I/AAAAAAAABCg/gGF04s-jL7U/s1600-h/image%5B130%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_myliFgNI/AAAAAAAABCk/oUn7jKFX-qQ/image_thumb%5B76%5D.png?imgmax=800" width="484" height="176" /></a></p>  <p>Well, we’d better overwrite the local file since we it currently contains changes for the story branch not our integration branch</p>  <p>Unfortunately if we do so, our local changes will now be gone.&#160; The pending changes we had floating about somewhere are toast!&#160; In fact if we try and commit a file that is not currently mapped we get a dialog like this:</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TY_mzf74tuI/AAAAAAAABCo/xHE1raxtdHw/s1600-h/image%5B132%5D.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TY_m0IC3pZI/AAAAAAAABCs/woTqx8TezW8/image_thumb%5B78%5D.png?imgmax=800" width="494" height="244" /></a></p>  <p>Hmm. OK. Not great.</p>  <h2>Good Practices for In Place Branch Switching with TFS 2010</h2>  <p>This means that in order for us to make branch switching as painless as possible with TFS, we should remember a few simple things:</p>  <ol>   <li>Ensure there are no pending changes before switching.&#160; Use shelvesets as needed to preserve changes.</li>    <li>The command line is faster.&#160; Don’t be afraid to use it.</li>    <li>Ensure our workspace mappings are to folders marked as branches in TFS 2010 </li> </ol>  <p>And that’s it.&#160; Go make the most of it, and if you bump into any edge cases feel free to post a comment about it.</p>  