---
layout: post
title: Stop Using Assert.Throws in Your BDD Unit Tests
date: '2015-07-14T13:05:00.001+10:00'
author: Richard Banks
tags: 
modified_time: '2015-07-14T16:38:15.201+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-2589705066430505514
blogger_orig_url: http://www.richard-banks.org/2015/07/stop-using-assertthrows-in-your-bdd.html
---

I’m sure we’ve all seen the <i>Assert.Throws</i> assertion in test code by now, but just in case you haven’t, here's a simple example:<br /><pre class="brush: c#">[Test]<br />public void InsertTestNameHere()<br />{<br />    var input = "a string";<br />    Assert.Throws&lt;FormatException&gt;(() =&gt; int.Parse(input));<br />}</pre>If we consider this from an Arrange-Act-Assert (AAA) perspective it’s pretty easy to see that the Act and Assert logic are in a single line. It’s a very common pattern. It works, it works well, and the readability is fine, but if we start using a BDD approach to our unit testing (e.g. with SpecFlow) or we want to explicitly keep the Arrange, Act and Assert sections of our test code separated then Assert.Throws gets in the way.<br />To fix this we need a way of catching the exception and treating it like a normal object. In NUnit, the <i>Assert.Catch</i> method is for just this purpose. Here’s the adjusted code (using NUnit)<br /><pre class="brush: c#">[Test]<br />public void InsertTestNameHere()<br />{<br />    var input = "a string";<br />    var exception = Assert.Catch(() =&gt; int.Parse(input));<br />    Assert.IsInstanceOf&lt;FormatException&gt;(exception);<br />}</pre>In this case we’re catching any exception that <i>int.Parse</i> might throw. If we were more explicit and used <i>Assert.Catch&lt;FormatException&gt;()</i>, NUnit’s behaviour becomes much the same as <i>Assert.Throws</i>, and the test fails immediately if the expected exception isn’t detected. This isn't a behaviour we want, which is why we're using the generalised catch method. Now, since we have our exception in a variable, we can check if it’s the one we expected.<br />Oh, I forgot to mention it, but if no exception is thrown, Assert.Catch() fails the test immediately. It is an assertion after all. I’m sort of OK with this… but not really, as we’re still mixing assertions and actions on the same line and haven't resolved my original complaint.<br />For this reason I prefer XUnit’s approach.<br /><pre class="brush: c#">[Fact]<br />public void InsertTestNameHere()<br />{<br />    var input = "a string";<br />    var exception = Record.Exception(() =&gt; int.Parse(input));<br />    Assert.NotNull(exception);<br />    Assert.IsType&lt;FormatException&gt;(exception);<br />}</pre>The Record.Exception() method won't fail the test, regardless of what happens in the method. Unlike the NUnit approach, it merely records any exception arising from the call or returns null if no exception was thrown. Personally, I feel this approach is a better way to write tests around exceptions while still remaining consistent with the AAA approach. It also works well when using a BDD testing framework that separates the given/when/then step implementations as you can pass the result of the “when” method to the “then” methods with ease.  