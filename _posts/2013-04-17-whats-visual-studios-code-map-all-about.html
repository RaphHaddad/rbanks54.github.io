---
layout: post
title: What’s Visual Studio’s Code Map All About?
date: '2013-04-17T22:18:00.001+10:00'
author: Richard Banks
tags:
- Visual Studio
- development
modified_time: '2013-04-17T22:18:17.380+10:00'
thumbnail: http://lh3.ggpht.com/-RNFmqrRhAMY/UW6Sz5IF2II/AAAAAAAABY8/GAeVmzVUoOs/s72-c/image_thumb%25255B22%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-62940248213458550
blogger_orig_url: http://www.richard-banks.org/2013/04/whats-visual-studios-code-map-all-about.html
---

<p>In Visual Studio 2012 Update 1 (VS 2012.1) Microsoft delivered a feature for the Ultimate edition called Code Map with the goal of visualising relationships in code.</p>  <p>In Visual Studio 2012 Update 2 (VS 2012.2) they’ve extended the Code Map experience to include debugging support and the ability to generate code maps on the fly as a debugging session is conducted.</p>  <p>If you saw the announcement then you may have had one of the following reactions. Reaction 1 would be something like “Oh. It’s in Ultimate. I don’t have it. I’ll ignore it”. The second might be similar to mine: “Is this really going to be that useful?”. After ignoring it for a bit I decided to answer that question for myself.</p>  <p>For the purposes of this post, I’m used the excellent RestSharp project. You can grab it from <a title="https://github.com/restsharp/RestSharp" href="https://github.com/restsharp/RestSharp">https://github.com/restsharp/RestSharp</a>. Oh, if you’re not aware of what it does, it’s a library that help’s you build REST based client and server applications by taking away a lot of the plumbing work you would otherwise have to do.</p>  <h3>Getting Started</h3>  <p>To start begin by asking a simple question. How does RestSharp make a client request? I’d never looked at the internals of RestSharp before so I wasn’t sure where to look.</p>  <p>Fortunately RestSharp comes with a set of unit and integration tests that I could use to explore the code with. I started with the integration tests and tried to find a suitable test in there to use and came across the <strong>Handles_Non_Existent_Domain()</strong> test. That seems a reasonable place to start. Note that if you want to follow along at home you’ll need the <a href="http://visualstudiogallery.msdn.microsoft.com/463c5987-f82b-46c8-a97e-b1cde42b9099" target="_blank">XUnit.Net Test Runner for Visual Studio 2012</a> extension installed since the tests are written for xUnit.</p>  <p>First thing to do? Set a breakpoint on the first line of the <strong>Handles_Non_Existent_Domain()</strong> test and start debugging the test. When the breakpoint is hit open a Code Map for the debugging session by either clicking the button in the toolbar (highlighted in the screenshot), choosing <strong>Show Call Stack on Code Map</strong> from the <strong>Debug </strong>menu, or pressing <strong>Ctrl+Shift+`</strong> if you’re using the default keyboard mappings.</p>  <p><a href="http://lh5.ggpht.com/-of6PDnFZKwM/UW6SzRMFB6I/AAAAAAAABY0/0YhCX3EYnR8/s1600-h/image%25255B64%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh3.ggpht.com/-RNFmqrRhAMY/UW6Sz5IF2II/AAAAAAAABY8/GAeVmzVUoOs/image_thumb%25255B22%25255D.png?imgmax=800" width="239" height="30" /></a></p>  <p>Visual Studio will now split the document window and display a second document pane with the code map in it. Initially the code map will looks like this:</p>  <p><a href="http://lh6.ggpht.com/-6KWbwb8Dld0/UW6S0pF5htI/AAAAAAAABZE/S8JCNHum8qQ/s1600-h/image%25255B67%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh6.ggpht.com/-_on6-8m6kYs/UW6S1QO2LPI/AAAAAAAABZM/3S8ABXzmt5s/image_thumb%25255B25%25255D.png?imgmax=800" width="238" height="107" /></a></p>  <p>Not very interesting, right? Don’t worry, it gets better. Let’s start stepping into various methods to see how this test works.</p>  <h3>Stepping Deeper</h3>  <p>Press F11 to step into the <strong>RestClient</strong> constructor. As you do, you will notice the code map updating. Continue to step through the code until the first call to <strong>AddHandler()</strong> has completed. Your Code Map should now show something like the following:</p>  <p><a href="http://lh5.ggpht.com/-clukpHNl6Mc/UW6S1itMRmI/AAAAAAAABZU/avW5EMcfi1Q/s1600-h/image%25255B70%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh5.ggpht.com/-QMa0JH_rMyo/UW6S2I9KwGI/AAAAAAAABZc/nm2knATGgy8/image_thumb%25255B28%25255D.png?imgmax=800" width="431" height="412" /></a></p>  <p>Note that as we step back up the call stack that the colours of nodes in the Code Map change to reflect that methods we have called but that are no longer in the call stack. It helps us keep track of where we’ve been, not just where we are now.&#160; This is kinda cool. I no longer have to mentally keep this tree in my head, and can focus more on what the code is doing rather than where I’ve been and which methods might be relevant later on.</p>  <p>Depending on your resolution, you may also start noticing the zoom level on your Code Map keeps resetting. If you want it to use a specific zoom value then go to the layout options and turn off “Automatically Layout when Debugging”</p>  <p><a href="http://lh5.ggpht.com/-uSoBsNpX_pI/UW6S2_4fgZI/AAAAAAAABZk/Sc-U2B_lhBo/s1600-h/image%25255B72%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh5.ggpht.com/-vSgyzHQ1pkw/UW6S3VW1BLI/AAAAAAAABZs/O1C25Vsw944/image_thumb%25255B30%25255D.png?imgmax=800" width="404" height="322" /></a></p>  <h3>What Happens When You Skip Over Methods?</h3>  <p>The code map only updates when execution pauses. It means that if you step over methods the Code Map will not show you what happened in the code you stepped over. It also means that if you use multiple breakpoints and after hitting the first breakpoint continue execution until you hit the next one, then the Code Map will only reflect the call stack from when the breakpoints were hit. You won’t see anything related to what happened in between breakpoints.</p>  <p>It helps keep the noise in the map down, and presumes that if you’ve skipped over code you’re also not interested in seeing it in the map. That seems to be a reasonable assumption to me.</p>        <p>Anyway, let’s get back to the test we were stepping through and continue execution until we get to the line that calls the <strong>Client.Execute()</strong> method.</p>  <p>As you step into the method the Code Map will update. Look at the tooltip for the newly added node and you will see details of the method itself based on XML Doc comments, as shown:</p>  <p><a href="http://lh4.ggpht.com/-5_Gs73lF1YI/UW6S3zl-afI/AAAAAAAABZ0/jIM0xXFehI0/s1600-h/image%25255B74%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh3.ggpht.com/-GeT4m2wdRCo/UW6S4piqARI/AAAAAAAABZ8/MTqjBimzouU/image_thumb%25255B32%25255D.png?imgmax=800" width="590" height="206" /></a></p>  <p>This can be handy when you’re deep within the bowels of something and can’t remember exactly how you got to where you are or which specific overload of a method was called.</p>  <p>If we then step into the switch statement, we see that we’re passing in a value of <strong>Method.GET</strong>. It might be handy to remember that; especially as both parts of the switch statement call <strong>Execute()</strong>. We can make a note of that on the Code Map by right clicking the node and selecting <strong>Add Comment</strong> (or hitting <strong>Ctrl+Shift+K</strong>)</p>  <p><a href="http://lh3.ggpht.com/-Rnxe5_OKuwM/UW6S5AskseI/AAAAAAAABaE/OcPU__tr_Do/s1600-h/image%25255B82%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh5.ggpht.com/--R4tSY6vctw/UW6S5gCkICI/AAAAAAAABaM/Zmk8m-qCmPM/image_thumb%25255B40%25255D.png?imgmax=800" width="343" height="181" /></a></p>  <p>At various point you’ll notice that the some calls go through external code first. The code map will reflect this when it occurs by marking the fact on the call stack arrow, as shown.</p>  <p><a href="http://lh6.ggpht.com/-xKz6Nmmbf1o/UW6S6bBmhNI/AAAAAAAABaU/Yoj6UwxAkxU/s1600-h/image%25255B86%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh6.ggpht.com/-nMWL6RBfZPI/UW6S7OkDwzI/AAAAAAAABac/XX_oEjHVm5U/image_thumb%25255B44%25255D.png?imgmax=800" width="321" height="255" /></a></p>  <h3>Way Down Deep</h3>  <p>If you continue to step through the code you will eventually get to the <strong>RestSharp.Http.GetRawResponse()</strong> method and your Code Map will start to look somewhat busy, as follows:</p>  <p><a href="http://lh6.ggpht.com/-d2Fr-RZrGN0/UW6S7_xAnuI/AAAAAAAABak/kccHkf-Yn-s/s1600-h/image%25255B78%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh6.ggpht.com/-DQl-pjBPcxE/UW6S8144veI/AAAAAAAABas/nzMqUevKKTk/image_thumb%25255B36%25255D.png?imgmax=800" width="640" height="193" /></a></p>  <p>A lot of the nodes in the Code Map are not that interesting now that we’ve stepped through things and are improving our understand of how it fits together. It’s fast becoming noise. To organise the map better we could simply select nodes we’re not interested in anymore and delete them or we can choose to group them by selecting a few, hitting the mouse right-click context menu and choosing <strong>Add Parent Group</strong>, to get something like the following:</p>  <p><a href="http://lh6.ggpht.com/-Q-TVqGWLoSw/UW6S9h1FasI/AAAAAAAABa0/_MaUw3FNF7w/s1600-h/image%25255B80%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh4.ggpht.com/-n4Fs7P0HRrk/UW6S-FXpXCI/AAAAAAAABa8/jrsB89iAsTw/image_thumb%25255B38%25255D.png?imgmax=800" width="542" height="295" /></a></p>  <p>We can then simply collapse groups to hide items we’re not really interested in at the moment.</p>  <p>With a little bit of judicious grouping I produced a Code Map as follows and now I have something that helps me better navigate the internals of RestSharp and get familiar with it.</p>  <p><a href="http://lh6.ggpht.com/-wHb0rM4d4dA/UW6S-9Xo-WI/AAAAAAAABbE/g6fgAhoqEyk/s1600-h/image%25255B85%25255D.png"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; display: inline; padding-right: 0px" border="0" alt="image" src="http://lh4.ggpht.com/-bns9DM0j0u8/UW6TBwfSJHI/AAAAAAAABbM/TlyIBZNoMJo/image_thumb%25255B43%25255D.png?imgmax=800" width="640" height="462" /></a></p>  <h2>Wrapping it Up</h2>  <p>I can add to this map over time as I explore the code further and step through other tests to see how it works, I can also get a feel for which parts of the code are called often and what happens in those methods.</p>  <p>If I wished I could also save the code map and share it with the rest of team, or grab an image of it and post it in the team wiki for documentation purposes or put it on the wall as a reference.</p>  <p>While Code Maps might seem a little gimmicky at first, I’m finding them fast becoming an useful tool in helping me better understand code I’m wading through and in improving my knowledge of what exactly is happening when I’m using an application.</p>  <p>Give Code Maps a try (assuming you have a copy of Ultimate) and see what you think.</p>  