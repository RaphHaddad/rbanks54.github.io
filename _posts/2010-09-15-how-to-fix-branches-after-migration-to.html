---
layout: post
title: How To Fix Branches After Migration to TFS2010
date: '2010-09-15T13:50:00.001+10:00'
author: Richard Banks
tags:
- TFS
modified_time: '2010-09-15T14:02:12.571+10:00'
thumbnail: http://lh3.ggpht.com/_5dD_rBQSs2o/TJA6PcDVGEI/AAAAAAAAA2k/Dk3B82Kb3FM/s72-c/image_thumb%5B19%5D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-1258876848699614367
blogger_orig_url: http://www.richard-banks.org/2010/09/how-to-fix-branches-after-migration-to.html
---

<p>Let’s say you’ve just migrated your code from another version control system to TFS2010 by grabbing the old code, copying it into your workspace as is, and then checking it in to TFS as a single massive import.&#160; It’s a really easy and common way to do tip migration.</p>  <p>When you do this, you will notice that all your branch relationships are missing and source control will look something like this:</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TJA6Ot2xkUI/AAAAAAAAA2g/ENW4OZHrqwA/s1600-h/image%5B47%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TJA6PcDVGEI/AAAAAAAAA2k/Dk3B82Kb3FM/image_thumb%5B19%5D.png?imgmax=800" width="217" height="117" /></a> </p>  <p>The old system had Trunk branched to Feature X and Version 1, etc, but now there’s no relationships and trying to merge from Trunk to a branch brings up a dialog with no targets.</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TJA6RLc0H6I/AAAAAAAAA2o/wIBaSV76Dzo/s1600-h/image%5B46%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/TJA6SZyw_cI/AAAAAAAAA2s/jXvx5GQ3M6k/image_thumb%5B18%5D.png?imgmax=800" width="480" height="402" /></a> </p>  <p>Bummer, huh?&#160; Yeah, but what did you expect would happen? You’ve just imported a bunch of folders from the file system and TFS has no way of knowing that they’re branches.</p>  <p>We need to let it know which folders the branches are and the relationships between them.&#160; Here’s how we do it:</p>  <h3>Step 1: Convert Folders to Branches</h3>  <p>Right click the trunk folder (or whatever your root branch folder is) and convert it to a branch.</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TJA6S8XQiFI/AAAAAAAAA2w/o3C5eLiibyE/s1600-h/image%5B44%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TJA6Tmo02FI/AAAAAAAAA20/nnvOc3KNKfA/image_thumb%5B16%5D.png?imgmax=800" width="474" height="101" /></a> </p>  <p>It should now look like this:</p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TJA6Ucq4U3I/AAAAAAAAA24/Af4dNlkax-M/s1600-h/image%5B11%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TJA6VYEqDBI/AAAAAAAAA28/2-SfTEQUyjg/image_thumb%5B3%5D.png?imgmax=800" width="207" height="113" /></a></p>  <p>Do this for all the other target branches you have.&#160; e.g. Feature X and Version 1.</p>  <h3>Step 2: Perform a Baseless Merge</h3>  <p>Next, perform a TFS baseless merge to establish a relationship between the parent branch and the child branches.&#160; Don’t worry about the contents, we’re only going to merge the folder, not it’s contents.</p>  <p>TFS baseless merges are performed via the command line, so open up your VS2010 command prompt and do the following:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:781501e9-6816-4112-bb41-50b2e0ba7ae8" class="wlWriterEditableSmartContent"><pre class="brush: xml;">cd &lt;workspaceFolder&gt;<br />tf merge /baseless &lt;trunk&gt; &lt;childBranch&gt;</pre></div><p>Check in your pending changes.</p><h3>Step 3 Reparent Child Branches</h3><p>At this point we have a loose link between the branches but the relationships are still not finalised.&#160; We need to fix that.</p><p>Select your <em>child </em>branch in Source Control Explorer and from the File menu choose Source Control –&gt; Branching and Merging –&gt; Reparent...&#160; NOTE: This is not available via the context menu in Source Control Explorer.</p><p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TJA6WNnf5AI/AAAAAAAAA3A/c4mMKA2A0c8/s1600-h/image%5B49%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TJA6XWXrhII/AAAAAAAAA3E/PJixueE_XU4/image_thumb%5B21%5D.png?imgmax=800" width="460" height="139" /></a> </p><p>In the dialog box, choose the appropriate branch as the new parent.&#160; There generally should only be one, unless you have done multiple baseless merges.</p><p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TJA6X5JXlTI/AAAAAAAAA3I/16_4Jmf-HOE/s1600-h/image%5B51%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/TJA6YrK7SDI/AAAAAAAAA3M/szH_AbkBtHM/image_thumb%5B23%5D.png?imgmax=800" width="406" height="400" /></a> </p><p>Now look at the properties of your child branch and you should see something like this:</p><p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TJA6ZRrYPzI/AAAAAAAAA3Q/UUt341JsPzQ/s1600-h/image%5B52%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/TJA6auv_q9I/AAAAAAAAA3U/zguQjadgz8I/image_thumb%5B24%5D.png?imgmax=800" width="348" height="177" /></a> </p><p>Excellent!&#160; If you go to your Trunk branch and in the branch context menu choose View Hierarchy. You should see something like this:</p><p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TJA6bHfIy7I/AAAAAAAAA3Y/7mOXD-tbEOU/s1600-h/image%5B54%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_5dD_rBQSs2o/TJA6b8pP8JI/AAAAAAAAA3c/_Gu-BwvnuZE/image_thumb%5B26%5D.png?imgmax=800" width="332" height="175" /></a> </p><p>Brilliant.&#160; Now we’re all done.&#160; You can carry on using TFS as you normally would.</p><p>Enjoy!</p>