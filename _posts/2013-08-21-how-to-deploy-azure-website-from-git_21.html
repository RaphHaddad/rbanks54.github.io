---
layout: post
title: How to deploy an Azure website from a Git repository on Team Foundation Service
date: '2013-08-21T17:15:00.001+10:00'
author: Richard Banks
tags:
- TFS
modified_time: '2013-11-14T12:13:51.198+11:00'
thumbnail: http://lh3.ggpht.com/-4ggNaL0_L9Q/UhRo9im8VeI/AAAAAAAABeA/I_4sOI9dIAo/s72-c/image_thumb%25255B7%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-9188239412549228970
blogger_orig_url: http://www.richard-banks.org/2013/08/how-to-deploy-azure-website-from-git_21.html
---

<span style="color: #cc0000;">UPDATE: Azure can now talk to Git on TFService, making this post obsolete.</span><br /><br />At the time of writing (August, 2013) you can connect a Windows Azure web site to the Team Foundation Service (TFService) for automated deployments, but only if your source is under Team Foundation Version Control (TFVC).<br />If you’re using a git repository then you're currently out in the cold. The Azure team hasn't yet added support for it, though I'm sure it'll show up at some point. In the meantime, you can always <a href="http://www.mygreatwindowsazureidea.com/forums/34192-general-feedback-/suggestions/4315681-support-deployment-from-git-repos-on-team-foundati" target="_blank">vote for it</a> on the Azure User Voice site.<br />All is not lost however as you can still automatically deploy the web site by using Web Deploy as part of the build process.<br />For this example, we'll deploy a very simple site built on top of Nancy with NuGet package restore enabled.<br />1. Firstly, create a site in Azure and then download the publishing profile.<br /><a href="http://lh5.ggpht.com/-IF8CYjq_gIk/UhRo8qIC-rI/AAAAAAAABd4/_QxYapkhicg/s1600-h/image%25255B11%25255D.png"><img alt="image" border="0" height="484" src="http://lh3.ggpht.com/-4ggNaL0_L9Q/UhRo9im8VeI/AAAAAAAABeA/I_4sOI9dIAo/image_thumb%25255B7%25255D.png?imgmax=800" style="background-image: none; border-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="620" /></a><br />2. Import the <em>PublishSettings</em> file into your web project.<br /><a href="http://lh4.ggpht.com/-bTH7B5sXoQ8/UhRo-GybHkI/AAAAAAAABeI/bG_Ra1VHJ5s/s1600-h/image%25255B9%25255D.png"><img alt="image" border="0" height="287" src="http://lh6.ggpht.com/-zx_SCvYZY10/UhRo-rArtwI/AAAAAAAABeQ/KCeXsCSLcbc/image_thumb%25255B5%25255D.png?imgmax=800" style="background-image: none; border-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="640" /></a><br />3. Validate the connection and click close.&nbsp; (You can check your deployment by doing a manual deployment if you wish)<br />4. Manually open the <em>PublishSettings</em> file you downloaded and make a note of the <strong>userName</strong> and <strong>userPWD</strong> values. You'll use those in a minute.<br /><a href="http://lh4.ggpht.com/-FIW6YL3kdyY/UhRo_HWzdQI/AAAAAAAABeY/QOk6BrgSn4o/s1600-h/image%25255B16%25255D.png"><img alt="image" border="0" height="218" src="http://lh4.ggpht.com/-hSHmi6b0bQI/UhRo_2LYkvI/AAAAAAAABeg/5iG2POpOjN8/image_thumb%25255B10%25255D.png?imgmax=800" style="background-image: none; border-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="644" /></a><br />4. In <strong>Team Explorer</strong> switch to the <strong>Builds </strong>hub and click the <strong>New Build Definition</strong> link.<br />5. Give your build a name, select a <strong>Trigger </strong>and confirm that the <strong>Source Settings</strong> point to the appropriate git branch.<br />6. In the <strong>Process</strong> settings, use the <strong>Default Template</strong> and in the <strong>Advanced | MSBuild</strong> arguments property add the following:<br /><blockquote>/p:DeployOnBuild=true /p:PublishProfile=<em>&lt;your profile&gt;</em> /p:AllowUntrustedCertificate=true /p:UserName=<em>&lt;your user name&gt;</em> /p:Password=<em>&lt;your pwd&gt;</em> /p:VisualStudioVersion=11.0</blockquote>In my case this would be:<br /><blockquote>/p:DeployOnBuild=true /p:PublishProfile="ADemoSite - Web Deploy" /p:AllowUntrustedCertificate=true /p:UserName=$ADemoSite /p:Password=83LukXHlmqEg75xxxxxx&nbsp; /p:VisualStudioVersion=11.0</blockquote>Note that since the profile name contains spaces, I’ve wrapped it in quotes.<br /><a href="http://lh5.ggpht.com/-dq-tPvrc0mE/UhRpAnTy6RI/AAAAAAAABek/Gp7K5-ilDt8/s1600-h/image%25255B23%25255D.png"><img alt="image" border="0" height="448" src="http://lh3.ggpht.com/-kdtmip_7Jms/UhRpBe9lzMI/AAAAAAAABew/pEjnGeiyS2w/image_thumb%25255B13%25255D.png?imgmax=800" style="background-image: none; border-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="644" /></a><br />7. Save the build definition and queue a new build.<br />8. Once the build completes you should be able to navigate to your site and see your newly deployed site.<br /><a href="http://lh5.ggpht.com/-RFTgND_AWyg/UhRpB6M9LDI/AAAAAAAABe0/diBpFS0uIc0/s1600-h/image%25255B27%25255D.png"><img alt="image" border="0" height="107" src="http://lh3.ggpht.com/-6_vB4bJibG4/UhRpCX9NfTI/AAAAAAAABfA/mPVRE-FT9IE/image_thumb%25255B15%25255D.png?imgmax=800" style="background-image: none; border-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="502" /></a><br />And we’re done!<br /><br /><h4>Notes</h4>This is not the most secure of approaches for deploying a site. The password is stored in plain text in the build definition which means it’s shared amongst all the developers on the team. If you use this method, be aware of the risk.<br />If you forget the <em>/p:VisualStudioVersion=11.0</em> argument the build will succeed but your site won't be deployed. Leaving the flag off causes the VS2010 deployment tool to be used, not the VS2012 one so instead of deploying the site to Azure the build instead creates a deployment package that you would then have to run manually.