---
layout: post
title: How to Exclude a Method from Code Coverage
date: '2007-12-06T10:53:00.001+11:00'
author: Richard Banks
tags:
- readify
- ".net"
- testing
modified_time: '2007-12-06T10:53:40.324+11:00'
thumbnail: http://lh4.google.com/rbanks54/R1c5_TJDlPI/AAAAAAAAAMo/4Y_Aza1nSB0/s72-c/clip1%5B4%5D
blogger_id: tag:blogger.com,1999:blog-13321238.post-8524934419164140376
blogger_orig_url: http://www.richard-banks.org/2007/12/how-to-exclude-method-from-code.html
---

<p>Let's say you have a piece of C# code in Visual Studio 2005 that looks something like this: </p><pre class="codeblock">[<span style="color: rgb(43,145,175)">Serializable</span>]<br /><span style="color: rgb(0,0,255)">public</span> <span style="color: rgb(0,0,255)">class</span> DuplicateRecordException : <span style="color: rgb(43,145,175)">Exception<br /></span>{<br />    <span style="color: rgb(0,0,255)">public</span> DuplicateRecordException()<br />    {<br />    }<br /><br />    <span style="color: rgb(0,0,255)">public</span> DuplicateRecordException(<span style="color: rgb(0,0,255)">string</span> message)<br />        : <span style="color: rgb(0,0,255)">base</span>(message)<br />    {<br />    }<br /><br />    <span style="color: rgb(0,0,255)">public</span> DuplicateRecordException(<span style="color: rgb(0,0,255)">string</span> message, <span style="color: rgb(43,145,175)">Exception</span> innerException)<br />        : <span style="color: rgb(0,0,255)">base</span>(message, innerException)<br />    {<br />    }<br /><br />    <span style="color: rgb(0,0,255)">protected</span> DuplicateRecordException(SerializationInfo serializationInfo, StreamingContext streamingContext)<br />        : <span style="color: rgb(0,0,255)">base</span>(serializationInfo, streamingContext)<br />    {<br />    }<br />}</pre><br /><p>And in code coverage analysis you see this: <br /><p><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="226" alt="clip1" src="http://lh4.google.com/rbanks54/R1c5_TJDlPI/AAAAAAAAAMo/4Y_Aza1nSB0/clip1%5B4%5D" width="968" border="0"> <br /><p>You think to yourself “That’s silly! The class is just an exception, there’s no real code there and nothing to really test!&nbsp; How do I exclude this code from the code coverage calculations?” <br /><p>What you need to do is add an attribute to each method in the class (it won’t work at class level).&nbsp; You can use either [System.Diagnostics.DebuggerHidden] or [System.Diagnostics.DebuggerNonUserCode]. <br /><p>If you were to apply these attributes to a couple of methods in the DuplicateRecordException class and then re run coverage analysis you would see the following in the coverage results and the code window: <br /><p><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="202" alt="clip2" src="http://lh3.google.com/rbanks54/R1c6ADJDlQI/AAAAAAAAAMw/jlCYoxI1YlM/clip2%5B5%5D" width="940" border="0"> <br /><p><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="365" alt="clip_image004" src="http://lh5.google.com/rbanks54/R1c6AjJDlRI/AAAAAAAAAM4/ezlFfLzroa0/clip_image004%5B6%5D" width="492" border="0"> <br /><p>Notice that the methods aren’t marked in the source view (meaning they’re not part of the coverage analysis) and that our total non-covered blocks for the DuplicateRecordException class are reduced. <br /><p>Cool! <br /><h4>Caveats!&nbsp; Warnings!&nbsp; Danger!</h4><br /><p>There are a few things to watch out for here. <br /><p>Firstly, using the Debugger* attributes changes your debugging experience. <a href="http://msdn2.microsoft.com/en-au/library/system.diagnostics.debuggerhiddenattribute(VS.80).aspx">DebuggerHidden</a> will prevent you from stepping into the method or setting breakpoints in that code and <a href="http://msdn2.microsoft.com/en-au/library/system.diagnostics.debuggernonusercodeattribute(VS.80).aspx">DebuggerNonUserCode</a> will hide the code as debug time and automatically step over it.&nbsp; Click the links for more information. <br /><p>Secondly, and more importantly, exceptions are actually testable.&nbsp; In the screen shots above you can see that we actually have coverage on the AccountNotFound exception. Not having coverage for an exception is probably an indication that your tests don’t exercise failure conditions and hiding the exception from coverage could be hiding a problem with your unit testing strategy.</p>  