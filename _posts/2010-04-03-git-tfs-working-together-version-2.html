---
layout: post
title: Git & TFS Working Together – Version 2
date: '2010-04-03T18:14:00.002+11:00'
author: Richard Banks
tags:
- how to
- open source
- TFS
- tools
- development
modified_time: '2011-03-03T17:31:46.887+11:00'
thumbnail: http://lh5.ggpht.com/_5dD_rBQSs2o/S7bq4eIdXOI/AAAAAAAAAuA/ZLncXgewQaU/s72-c/git%20tfs%20workflow_thumb%5B6%5D.jpg?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-4466510156457707410
blogger_orig_url: http://www.richard-banks.org/2010/04/git-tfs-working-together-version-2.html
---

<p>UPDATE: Recent changes mean that the shelveset approach to checking in changes is no longer required. See <a href="http://www.richard-banks.org/2011/03/git-tfs-recent-improvements.html">Git-TFS Recent Improvements</a> for more information</p><hr /><p>I posted a while ago on how to get <a href="http://richardsbraindump.blogspot.com/2010/01/how-to-get-git-and-tfs-working-together.html" target="_blank">Git and TFS version control working together</a>, however there are some limitations with that approach that reduces it’s usefulness for some people, specifically that checking in doesn’t deal with check-in policies or being able to associate work items with a changeset.</p>  <p>Well, recently on <a href="http://groups.google.com.au/group/ozaltdotnet" target="_blank">the Australian Alt.Net mailing list</a> the discussion came up again in reference to getting Mercurial working with TFS, and during the conversation we were pointed to the <a href="http://github.com/spraints/git-tfs" target="_blank">git-tfs project</a> which I was unaware of before then.&#160; Curiosity appropriately piqued, I went and grabbed the code to see how it worked, and I’m pleased to say that the approach is much better that the previous approach I blogged about, though the issues with solution files still exist, though it’s somewhat alleviated with this approach.</p>  <h3>What is This git-tfs Thingy Anyway?</h3>  <p>OK, introduction time, the git-tfs project is a git plug-in, much like git-svn, and it defines some git commands that let git work against TFS source control.&#160; The nice thing about the approach it takes <a href="http://lh5.ggpht.com/_5dD_rBQSs2o/S7bq30irklI/AAAAAAAAAt8/TkSjEdmoX8Q/s1600-h/git%20tfs%20workflow%5B8%5D.jpg"><img style="border-bottom: 0px; border-left: 0px; margin: 0px 10px 0px 0px; display: inline; border-top: 0px; border-right: 0px" title="git tfs workflow" border="0" alt="git tfs workflow" align="left" src="http://lh5.ggpht.com/_5dD_rBQSs2o/S7bq4eIdXOI/AAAAAAAAAuA/ZLncXgewQaU/git%20tfs%20workflow_thumb%5B6%5D.jpg?imgmax=800" width="229" height="480" /></a>is that instead of trying to commit directly to TFS and having to deal with check in policies and all that jazz it creates a shelveset instead. You can then switch to Team Explorer and do an unshelve and check in using the normal TFS practices.&#160; The normal development workflow follows the path shown in the diagram on the left.</p>  <h3>Getting Started</h3>  <div>   <p></p>    <p>First up, you’ll need a version of git installed.&#160; I’ve tested using msysgit and it works well, so grab a copy of that if you haven’t already. Then either <a href="http://github.com/spraints/git-tfs/downloads" target="_blank">download git-tfs</a> or go grab yourself a copy of the source either from <a href="http://mattonrails.wordpress.com/" target="_blank">Matt Burke</a>’s (<a href="http://twitter.com/spraints" target="_blank">@spraints</a>) <a href="http://github.com/spraints/git-tfs" target="_blank">repository</a> or from my own fork. My fork includes changes to make it work with TFS2010 and alternate user accounts, and hopefully Matt will take those onboard for his next release.</p>    <p>Remember, if you download the source you’ll need the Visual Studio SDK in order to build it.</p>    <p>Also you’ll need to add the folder where the compiled output to your path, so that git knows where to look for the “git tfs” commands you are going to use.</p>    <h3>Clone TFS</h3>    <p>You should now be able to get the source from TFS via git using the “<strong>git tfs clone</strong>” command, as shown here</p>    <blockquote>     <p><font face="Courier New">git tfs clone </font><a href="http://tfs2008-vm:8080"><font face="Courier New">http://tfs2008-vm:8080</font></a><font face="Courier New"> $/TeamProject0 local_git_folder</font></p>   </blockquote>    <p>Just pass in the source control folder you want to clone and the local folder you want the repository created in and wait for the code to download.&#160; If you need to supply non-default credentials as I do when working with my virtual machines, then you’ll need to supply the –username option, for example:</p>    <blockquote>     <p><font face="Courier New">git tfs clone --username tfs2008-vm\tfssetup </font><a href="http://tfs2008-vm:8080"><font face="Courier New">http://tfs2008-vm:8080</font></a><font face="Courier New"> $/TeamProject0 local_git_folder</font></p>   </blockquote>    <p>Note that the –username option only works if you grab my fork (at least until the changes are merged back into spraints version).&#160; When you use that option you’ll be prompted with the usual TFS credentials dialog box so you can enter your password every time you do a git tfs command.</p>    <p>Oh! Be aware that the folder you check out your git source to should be different than the folder used for your normal TFS workspace controlled work.</p>    <p>Yes, this means you’ll have 2 copies of the source.&#160; One workspace/tfs controlled copy and one git controlled copy.</p>    <h3>What About Those Solution Files?</h3>    <p>Yes, I know, those pesky solution files with their inbuilt source control links that force you to connect to TFS when you open the solution.&#160; They’re enough to drive a person to drink!</p>    <p>So, here’s the easy way to deal with it.&#160; After cloning your repository, pull out the network cable from your PC or turn off wireless and then open the solution.&#160; When prompted to go into offline mode, simply say “Yes! Of course I want to go offline you great lump!&quot; and watch the solution open normally.&#160; You can then plug your network cable back in and carry on as if nothing had ever happened.&#160; Visual Studio will keep the solution in offline mode until such time as you tell it otherwise, and considering we’re using git for source control, that means we never will.</p>    <p>Option Two? Create a local branch of your code and remove the source control bindings from the solution in your local branch.&#160; It’s a little more work, and you’ll have some more merging to do between your master and local branches, but it is just that tiny bit safer.</p>    <p>The choice is up to you, though I’d probably lean towards the first option for now.</p>    <h3>Shelve Your Changes</h3>    <p>OK, so now go make some changes in your git version of the code and commit them to the repository.&#160; Once you’ve finished we can think about pushing them up to the TFS server.</p>    <p>The way this works is that all local changes you make are aggregated into a shelveset and placed on the server.&#160; This way you don’t need to worry about rewriting local history or having multiple shelvesets on the server that you would have to process in chronological order.</p>    <p>Push your changes using “<strong>git tfs shelve</strong>” as follows:</p>    <blockquote>     <p><font face="Courier New">git tfs shelve &quot;my shelveset name&quot;</font></p>   </blockquote>    <p>Now switch to the TFS controlled version of the project, go to the pending changes window and Unshelve your newly created shelveset.&#160; Check that everything is OK and do your normal TFS check in, with all the normal policies and association with work items applied that you need to.</p>    <h3>Fetching Updates</h3>    <p>Nice! OK, so now we have our local changes in TFS.&#160; What about the reverse? What if we now want to get updates from TFS down to update our local git repository?</p>    <p>All we need to do is a “<strong>git tfs fetch</strong>”.&#160; When we do, git-tfs will go off and grab the latest changesets from the server and bring them down as tagged objects.&#160; They won’t get directly applied to the master copy, so it’s up to you to bring those changesets in yourself.</p>    <p>This is where you need to do a local “<strong>git merge</strong>” to take those tagged objects and merge them into your working copy.&#160; You can do this via the command line or using the Git Gui as shown here</p>    <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/S7bq5CkNXkI/AAAAAAAAAuE/vb7kd_g-sK4/s1600-h/image%5B10%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/S7bq5wqgWCI/AAAAAAAAAuI/Z1BjCJ9vgCs/image_thumb%5B6%5D.png?imgmax=800" width="478" height="351" /></a> </p> </div>  <p>Once the merge is done you should be able to see all the changes from TFS, and visualise it using the git gui tools, for example:</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/S7bq6iL-ILI/AAAAAAAAAuM/ECQT4w7xaRE/s1600-h/image%5B24%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/S7bq7TNCz8I/AAAAAAAAAuQ/5SIKBIPR6kQ/image_thumb%5B16%5D.png?imgmax=800" width="420" height="229" /></a> </p>  <p></p>  <p>And that’s it, we have a workable approach to using git with TFS.&#160; Obviously there’s room for improvement with the possibility of committing directly to TFS, but for now this approach works well and I think it’s much better than the svn-bridge based approach I was using earlier.</p>  <p>&#160;</p>  <p>Kudos to <a href="http://mattonrails.wordpress.com/" target="_blank">Matt Burke</a> (<a href="http://twitter.com/spraints" target="_blank">@spraints</a>) for the great work in getting this together.&#160; It’s a great solution!</p>