---
layout: post
title: Why does Git Merge Work Better than TFS Merge
date: '2010-10-22T16:32:00.001+11:00'
author: Richard Banks
tags:
- development
modified_time: '2010-10-22T16:32:26.699+11:00'
thumbnail: http://lh4.ggpht.com/_5dD_rBQSs2o/TMEhsn2EM_I/AAAAAAAAA4E/4Ek8LHW5pvs/s72-c/image_thumb%5B2%5D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-5382347465964362261
blogger_orig_url: http://www.richard-banks.org/2010/10/why-does-git-merge-work-better-than-tfs.html
---

<p>The question came up during a discussion on our internal mailing list as to why Git’s merge is seen as better than the TFS merge.&#160; What better way to explain it than via a worked example:</p>  <h3>TFS Example</h3>  <p>Consider the following solution in TFS:</p>  <p><a href="http://lh6.ggpht.com/_5dD_rBQSs2o/TMEhsIScIFI/AAAAAAAAA4A/tNgNDYF-ftc/s1600-h/image%5B5%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TMEhsn2EM_I/AAAAAAAAA4E/4Ek8LHW5pvs/image_thumb%5B2%5D.png?imgmax=800" width="205" height="178" /></a></p>  <p>Now let’s branch it for two different teams.&#160; Team A and Team B.</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TMEhtAzul1I/AAAAAAAAA4I/--G8dKo9p9c/s1600-h/image%5B19%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TMEhtrukyxI/AAAAAAAAA4M/jJcj4IE1Gts/image_thumb%5B10%5D.png?imgmax=800" width="223" height="179" /></a></p>  <p>Now let’s go into TeamA’s code and refactor SomeClass to have a better name.&#160; Here’s the changeset that gets created.&#160; Note that we’ve changed the .csproj and Program.cs as well since they both had references to SomeClass.</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TMEhuOkNxxI/AAAAAAAAA4Q/FeCN9Jv9ULc/s1600-h/image%5B26%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/TMEhuvQOcrI/AAAAAAAAA4U/pyPR2yKKS-U/image_thumb%5B15%5D.png?imgmax=800" width="484" height="155" /></a></p>  <p>Meanwhile TeamB adds an extra property for some functionality they are adding:</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TMEhvVsQT6I/AAAAAAAAA4Y/tUcZYSsHUjY/s1600-h/image%5B24%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TMEhv5nTS7I/AAAAAAAAA4c/FtD-Xm0cudM/image_thumb%5B13%5D.png?imgmax=800" width="455" height="128" /></a></p>  <p>Team A then merges back to trunk.&#160; When merging in Visual Studio you can only merge between branches that are directly related to each other.</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TMEhwWTudWI/AAAAAAAAA4g/wDe4Wkqr0po/s1600-h/image23.png"><img style="background-image: none; border-right-width: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/TMEhxMOkirI/AAAAAAAAA4k/UiTH7jV-Bys/image_thumb15.png?imgmax=800" width="313" height="306" /></a></p>  <p>Team B then wants to merge to trunk, but as Team A checked in first, they decide to follow good practices and pull down the latest changes from Trunk and merge them first.&#160; Because the SomeClass file was renamed we now have a merge conflict as seen here:</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TMEhxnEgm8I/AAAAAAAAA4o/jKXBNRJ8Zrc/s1600-h/image%5B33%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TMEhyetJY_I/AAAAAAAAA4s/cukAxAOEHy4/image_thumb%5B18%5D.png?imgmax=800" width="484" height="145" /></a></p>  <p>And until we fix it our solution is broken.</p>  <p><a href="http://lh4.ggpht.com/_5dD_rBQSs2o/TMEhy1IP7OI/AAAAAAAAA4w/ZYv3_8gAlTA/s1600-h/image%5B29%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TMEhzYUeRcI/AAAAAAAAA40/S1fp2yuzttE/image_thumb%5B16%5D.png?imgmax=800" width="216" height="174" /></a></p>  <p>   <p>Visual Studio asks us what we want to do with the file name and we need to figure out what the right option is.&#160; Giving choice like this to the user is unnecessary and can easily result in a big mess.</p>    <h3>Git Example</h3>    <p>Let’s do the same thing using git.&#160; We start by creating a new project and making the two team branches.&#160; Note how the branches all point to the same commit instead of creating copies of all the files. </p> </p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TMEh0ODVRPI/AAAAAAAAA44/XxyoMyLOKs8/s1600-h/image%5B37%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TMEh0rlUXXI/AAAAAAAAA48/_ITD6ELPQNU/image_thumb%5B20%5D.png?imgmax=800" width="484" height="402" /></a></p>  <p>Now let’s refactor the TeamA code and add the property to TeamB as we did with the TFS example and commit the changes.&#160; We see the branches now have some changes and are diverging from each other.</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/TMEh1I9h88I/AAAAAAAAA5A/03ipAj-BwJ0/s1600-h/image%5B41%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TMEh171woHI/AAAAAAAAA5E/QVbr2biPQ94/image_thumb%5B22%5D.png?imgmax=800" width="297" height="143" /></a></p>  <p>Now let’s merge the TeamA changes to TeamB.&#160; For consistency with the TFS example we’ll do it by merging TeamA to master, and then master to TeamB</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TMEh2_FcaQI/AAAAAAAAA5I/3Lw_uu8Ryvk/s1600-h/image%5B49%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/TMEh3brxO2I/AAAAAAAAA5M/STUWDAIqHxM/image_thumb%5B26%5D.png?imgmax=800" width="457" height="429" /></a></p>  <p>Note that the merge from TeamA to master is a fast-forward merge.&#160; This happens because trunk hasn’t changed since TeamA branched so master can just be repositioned to the TeamA commit..</p>  <p>You can see that in the second merge from master to TeamB an auto-merge occurred, and git automatically detected that the changed SomeClass.cs file and the new SomeBetterName.cs file are actually the same file (with an 84% certainty), so it performed a rename for us automatically.</p>  <p>When we reload the solution in Visual Studio, everything looks fine, and we can get on with our development activities.&#160; Here’s what it looks like in the repository viewer:</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TMEh4MNDtQI/AAAAAAAAA5Q/OEQciUqRUTo/s1600-h/image%5B53%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/TMEh48JUHxI/AAAAAAAAA5U/fNXvJQ7KUb4/image_thumb%5B28%5D.png?imgmax=800" width="484" height="357" /></a></p>  <p>As a note, with git we don’t have to go via the master branch to merge TeamA changes to TeamB, we could have just done git merge TeamA as shown here:</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/TMEh5sCpOyI/AAAAAAAAA5Y/TZA9q8kCWbs/s1600-h/image%5B54%5D.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/TMEh6c8rmWI/AAAAAAAAA5c/HE5ML-4Aj1M/image_thumb%5B29%5D.png?imgmax=800" width="484" height="235" /></a></p>      <p>For reference, you don’t have to merge from TeamA to TeamB via Trunk in TFS either.&#160; TFS has a baseless merge option that you can run via the command line, though when you do the branch history can get a little messed up.</p>  <p>Here’s hoping that the next version of TFS will have a much better story around rename detection and version control in general.</p>  