---
layout: post
title: 'Mocking Comparison – Part 10: Events'
date: '2010-08-04T12:20:00.001+10:00'
author: Richard Banks
tags:
- mocking
modified_time: '2010-08-06T08:57:05.994+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-4985608053408502176
blogger_orig_url: http://www.richard-banks.org/2010/08/mocking-comparison-part-10-events.html
---

<p>So far in our comparison we’ve been looking at mock objects as if they were much like any other object, but what happens when we want our mocks to either raise or subscribe to events?</p>  <p>If you’re testing how your class under test reacts when it receives an event, or want to know if it raises an event with correct values then you really need your mock framework to be able to support this.</p>  <h2>Subscribing To Events</h2>  <p>To get a mock object to subscribe to an event is pretty easy.&#160; Just do it like you normally would, and then if you want to assert anything about how the event was raised, simply assert that the subscription method was called as expected.</p>  <h3>Rhino Mocks</h3>  <p></p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:158bcf0a-7359-4a9c-a1ee-2bbf4cade68e" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Rhino_event_subscriber()<br />{<br /> var monkey = MockRepository.GenerateMock&lt;IMonkey&gt;();<br /> var keeper = new ZooKeeper();<br /> <br /> keeper.OnBananaReady += monkey.BananaReady;<br /> <br /> keeper.FeedMonkeys();<br /> monkey.AssertWasCalled(m =&gt; m.BananaReady(<br />  Arg&lt;object&gt;.Is.Equal(keeper)<br />  ,Arg&lt;BananaEventArgs&gt;.Matches(b =&gt; b.IsRipe<br /> )));<br />}</pre></div><p>As you can see, we subscribe to the event normally, with the event being raised by the FeedMonkeys() call.</p><p>We then check that the event was called correctly and that the IsRipe flag was set correctly.</p><h3>Moq</h3><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:dc494d48-859b-457c-b290-4eeea0445999" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Moq_event_subscriber()<br />{<br /> var monkey = new Mock&lt;IMonkey&gt;();<br /> var keeper = new ZooKeeper();<br /><br /> keeper.OnBananaReady += monkey.Object.BananaReady;<br /><br /> keeper.FeedMonkeys();<br /> monkey.Verify(m =&gt; m.BananaReady(keeper, <br />  It.Is&lt;BananaEventArgs&gt;(b =&gt; b.IsRipe)));<br />}<br /></pre></div><p>The syntax is much the same as for Rhino Mocks apart from the fact that the .Object. syntax again makes things feel clunky.&#160; On the positive side of things, the better constraint syntax in Moq makes the verify call far less noisy.</p><h3>NSubstitute</h3><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:b27df2ee-a8ca-4f46-80ad-b100f7132e77" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Nsubstitute_event_subscriber()<br />{<br /> var monkey = Substitute.For&lt;IMonkey&gt;();<br /> var keeper = new ZooKeeper();<br /><br /> keeper.OnBananaReady += monkey.BananaReady;<br /><br /> keeper.FeedMonkeys();<br /> monkey.Received().BananaReady(keeper,<br />   Arg.Is&lt;BananaEventArgs&gt;(e =&gt; e.IsRipe));<br />}</pre></div><p>The NSubstitute version is looks much the same as the Moq syntax, just without the .Object. stuff.</p><h2>Raising Events</h2><p>Raising an event is a pretty simply process.&#160; We simply get our class under test to subscribe to an event on our mock object and then ask our mock to raise an event.</p><h3>Rhino Mocks</h3><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:0893c40a-bb4c-46db-b59c-e063e8d877c4" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Rhino_raising_an_event()<br />{<br /> var monkey = MockRepository.GenerateMock&lt;IMonkey&gt;();<br /> var tourist = new Tourist();<br /><br /> tourist.SeeAMonkey(monkey);<br /><br /> monkey.Raise(m =&gt; m.Dance += null, monkey, new EventArgs());<br /> Assert.Equal(1, tourist.PhotosTaken);<br />}</pre></div><p>The line to pay attention to here is the second last one.&#160; The monkey.Raise() call.&#160; What you notice in here is that in order to raise an event we need to pass in an expression that registers an empty event listener.&#160; This is so Rhino can pick up the signature of the event you wish to raise.</p><p>Once that’s done we just provide arguments for the sender and event args that we wish to use for the event.</p><p>It’s a little weird looking but it works.</p><h3>Moq</h3><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:ed387b2b-2634-48a7-ba82-3b66ed679134" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Moq_raising_an_event()<br />{<br /> var monkey = new Mock&lt;IMonkey&gt;();<br /> var tourist = new Tourist();<br /><br /> tourist.SeeAMonkey(monkey.Object);<br /><br /> monkey.Raise(m =&gt; m.Dance += null, new EventArgs());<br /> Assert.Equal(1, tourist.PhotosTaken);<br />}</pre></div><p>The Moq code is much the same as the Rhino code, with the only difference being that by default the sender is the object raising the event and we don’t need to specify it.</p><h3>NSubstitute</h3><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:a018ab10-3d18-4eff-9fae-4bf5ac9397a0" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Nsubstitute_raising_an_event()<br />{<br /> var monkey = Substitute.For&lt;IMonkey&gt;();<br /> var tourist = new Tourist();<br /><br /> tourist.SeeAMonkey(monkey);<br /><br /> monkey.Dance += Raise.Event(new EventArgs());<br /> Assert.Equal(1, tourist.PhotosTaken);<br />}</pre></div><p>Here you see the code is much simpler.&#160; We still need to register a pseudo event listener when we want to raise the argument, but at the same time, it’s a little more obvious what’s going on.</p><p>All three frameworks suffer from needing to use event subscriptions to figure out what event to fire, but that’s a result of limitations in the way C# works rather than a poor design decisions.&#160; With that in mind the verdict on which syntax to choose goes to NSubstitute.&#160; Since event subscription is much the same across all 3 frameworks there’s not much to differentiate them, however event raising in NSubstitute is cleaner and more expressive than the syntax of both Rhino and Moq, making my choice rather easy.&#160; </p><p>&nbsp;</p><p>Other posts in this series:<ul><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-1-basics.html">1: The Basics</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-2-properties.html">2: Properties</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-3-interactions.html">3: Interactions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-4-parameter.html">4: Parameter Constraints</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-5-repetitions.html">5: Repetitions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-6-multiple.html">6: Multiple Calls</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-7-exceptions.html">7: Exceptions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-8-recursive.html">8: Recursive Mocks</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-9-functions.html">9: Functions</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-11-multiple.html">11: Multiple Interfaces</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-12-unmockables.html">12: The UnMockables</a></li></ul></p>