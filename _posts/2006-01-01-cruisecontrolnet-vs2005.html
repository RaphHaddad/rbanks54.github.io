---
layout: post
title: CruiseControl.NET & VS2005
date: '2006-01-01T13:35:00.000+11:00'
author: Richard Banks
tags:
- CruiseControl.NET
modified_time: '2007-06-22T11:43:52.381+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-113608486850939504
blogger_orig_url: http://www.richard-banks.org/2006/01/cruisecontrolnet-vs2005.html
---

I've just spent the last 2 days getting my team to migrate our solution from ASP.NET 1.1 to <a href="http://www.asp.net/Default.aspx?tabindex=0&tabid=1">ASP.NET 2.0</a> most of which was spent cleaning up compiler errors and making changes to get rid of warnings, etc.<br /><br />This went suprisingly smoothly considering the main solution has over 20 projects in it, and that there are some very ugly internal workarounds for some ASP.NET 1.1 limitations.<br /><br />Not wanting to do things by halves, at the same time we migrated our backend database to <a href="http://www.microsoft.com/sql/default.mspx">SQL Server 2005</a>. This was simplicity itself - just backup the database and restore it on the new server. How much easier could it get?<br /><br />So now, we have a solution that compiles, runs and behaves as expected on all the developers machines and we're all looking pretty good.<br /><br />All the code gets checked into <a href="http://subversion.tigris.org/">Subversion</a> (our source code repository) and then I remember that I haven't updated our build server. I'd forgotten to check for any "gotchas" on that one when planning the upgrade and it turns out there was one.<br /><br />We use <a href="http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET">CruiseControl.NET</a> (cc.net) as a <a href="http://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration Server</a> (as per agile methodologies) and this works beautifully. We've configured it to use <a href="http://nant.sourceforge.net/">NAnt</a> to manage the actual build process. Now this usually involves the following steps - clean the previous build, get the latest code from subversion, set version numbers in the assemblyinfo files according to the subversion change set number, do the compile, run the tests and copy the compiled results into a directory for potential release.<br /><br />The problem is that the NAnt script uses the solution task to compile the code, but under Visual Studio 2005 the solution is now a completely different format and there are no NAnt tasks for managing the build of a .NET 2.0 solution file. It turns out that the only way to do it (apart from building the solution one compile at a time) is to use <a href="http://lab.msdn.microsoft.com/vs2005/teams/msbuild/default.aspx">MSBuild</a> to do the compile.<br /><br />I didn't want to have to rewrite my NAnt script as an MSBuild script - far too much work, so what I did was to take the compile step, and call MSBuild using an exec task as follows:<br /><span style=";font-family:courier new;font-size:85%;"  ></span><br /><span style=";font-family:courier new;font-size:85%;"  >&lt;exec program="c:\winnt\microsoft.net\framework\v2.0.50727\msbuild.exe"</span><br /><span style=";font-family:courier new;font-size:85%;"  >commandline='MySolution.sln /p:Configuration=Release </span><br /><span style=";font-family:courier new;font-size:85%;"  >/logger:ThoughtWorks.CruiseControl.MsBuild.XmlLogger,</span><br /><span style=";font-family:courier new;font-size:85%;"  >   ..\ThoughtWorks.CruiseControl.MSBuild.dll</span><br /><span style=";font-family:courier new;font-size:85%;"  >/noconsolelogger /nologo /noautorsp'</span><br /><span style=";font-family:courier new;font-size:85%;"  >output="_msbuild.xml"</span><br /><span style=";font-family:courier new;font-size:85%;"  >failonerror="true"/&gt;</span><br /><br /><span style="font-family:georgia;"><span style="font-size:100%;">This worked OK, except that the solution contained a project for SQL 2000 reporting services reports, and this can't be built using MSBuild. I simply removed that project from the main solution, and left it as a VS2003 solution that could be built separately.<br /><br />The only other thing to note is the <a href="http://ccnetlive.thoughtworks.com/MSBuildXmlLogger%2DBuilds/">XMLLogger</a> is used. This was obtained from the CruiseControl site so that the results of the build could be viewed in the web browser (the workplace) with the nice colourisation of errors, warnings, etc.<br /><br />A bit of a pain in the neck to figure out what needed to change, but it works now and works well. All the other parts of the build process remain as they were, controlled by NAnt and in the end it's quite a small change.<br /></span><br /><br /></span><span style=";font-family:courier new;font-size:85%;"  ><span style="font-family:georgia;"></span></span><br /><br /><br /><span style=";font-family:courier new;font-size:85%;"  ></span>