---
layout: post
title: Cleaner Mocking with NSubstitute
date: '2010-07-06T10:18:00.002+10:00'
author: Richard Banks
tags:
- ".net"
- testing
- development
modified_time: '2010-07-06T10:27:38.700+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-4228256898911424782
blogger_orig_url: http://www.richard-banks.org/2010/07/cleaner-mocking-with-nsubstitute.html
---

<p>Rhino Mocks is a great mocking framework, being seen as one of the best ones around and rightly so, however it’s syntax at times is a little verbose and clunky.</p><p>A few of the guys from the <a title="Sydney Alt.Net User Group" href="http://sydney.ozalt.net/" target="_blank">Sydney Alt.Net</a> group who work together at <a title="Cochlear Australia" href="http://www.cochlear.com/au/" target="_blank">Cochlear</a> got a little fed up with the syntax Rhino uses for creating and managing mocks and figured there must be a better way.&#160; A different approach that will give them much cleaner code.&#160; As a result they’ve gone and created a project to produce a clean API for mocking and released it as an open sourced project called <a title="NSubstitute" href="http://nsubstitute.github.com" target="_blank">NSubstitute</a>.</p><p>For example, consider the following two code samples:</p><pre class="brush:csharp">[Fact]<br />public void Rhino_MethodWasCalled()<br />{<br />var monkey = MockRepository.GenerateMock&lt;IMonkey&gt;();<br />var keeper = new ZooKeeper {AssignedMonkey = monkey};<br />monkey.Stub(m =&gt; m.CurrentFleaCount()).Return(0);<br /><br />keeper.CleanMonkey();<br /><br />monkey.AssertWasCalled(m =&gt; m.CurrentFleaCount());<br />monkey.AssertWasNotCalled(m =&gt; m.Clean());<br />}<br /></pre><p>versus the equivalent test in NSubstitute</p><pre class="brush:csharp">[Fact]<br />public void NSubstitute_MethodWasCalled()<br />{<br />var monkey = Substitute.For&lt;IMonkey&gt;();<br />var keeper = new ZooKeeper { AssignedMonkey = monkey };<br />monkey.CurrentFleaCount().Returns(0);<br /><br />keeper.CleanMonkey();<br /><br />monkey.Received().CurrentFleaCount();<br />monkey.DidNotReceive().Clean();<br />}<br /></pre><p>In particular, not the way mocks are created, the way a method is stubbed and how the asserts are performed.&#160; The NSubstitute version has less code to create the mock and doesn’t require lambda’s for either the method stub or the asserts making it much more readable.&#160; I’m finding it much nicer to use than Rhino’s syntax and for me less typing and better readability is always a good thing :-) </p><p>There’s a lot of other things that the guys have done to make mocking cleaner and I’d strongly recommend you get yourself over to the <a title="NSubstitute project site" href="http://nsubstitute.github.com" target="_blank">NSubstitute project</a> site on <a title="NSubstitute GitHub Repository" href="http://github.com/nsubstitute/NSubstitute/" target="_blank">GitHub</a>, check out the other features and have a play.&#160; There’s still a few rough edges and features to be implemented but the majority of usage scenarios are covered so it’s very much usable for day to day work right now. By the way, <a title="Dave Tchepak announces NSubstitute" href="http://www.davesquared.net/2010/06/announcing-nsubstitute.html" target="_blank">Dave Tchepak announces NSubstitute</a> and shows a few more usage examples on his blog, which you should also go and have a look at.</p><p>Congratulations to both <a title="Dave Tchepak&#39;s website" href="http://www.davesquared.net/" target="_blank">Dave Tchepak</a> (<a title="Dave Tchepak on Twitter" href="http://twitter.com/davetchepak/" target="_blank">@davetchepak</a>) and Anthony Egerton (<a title="Anthony Egerton on Twitter" href="http://twitter.com/guywithbeard/" target="_blank">@guywithbeard</a>) for getting this thing together.&#160; Well done, and I hope this project really takes off :-)</p>