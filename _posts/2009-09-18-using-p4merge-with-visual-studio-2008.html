---
layout: post
title: Using P4Merge with Visual Studio 2008 and TFS
date: '2009-09-18T18:52:00.001+10:00'
author: Richard Banks
tags:
- TFS
- development
modified_time: '2009-09-18T18:52:23.036+10:00'
thumbnail: http://lh6.ggpht.com/_5dD_rBQSs2o/SrNKKZZFDSI/AAAAAAAAAqo/OZPQOlbKsWQ/s72-c/image_thumb%5B1%5D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-6932733755865760063
blogger_orig_url: http://www.richard-banks.org/2009/09/using-p4merge-with-visual-studio-2008.html
---

<p>The merge and diff utility included with Visual Studio 2008 is, let’s face it, not the best tool on the market.&#160; Sure, it does the job, but it could be so much better.&#160; Thankfully, Visual Studio gives you a way to customise the tool that is used for merging.</p>  <p>Now, in the past, I’ve usually gone for <a href="http://winmerge.org/" target="_blank">WinMerge</a> as my tool of choice to replace the out of the box offering, but WinMerge is starting to show it’s age and whilst it does a great job at comapres it doesn’t do 3-way merges, so I’d rather use something else.&#160; By the way, I keep WinMerge installed because of it’s great directory comparison feature.&#160; Oh, for those who don’t know, a 3-way merge is a merge that shows both your current version of the file, the file you’re merging with, and the root file from which the two other files are derived (i.e. the original).</p>  <p>Many people talk about how great the <a href="http://www.scootersoftware.com/" target="_blank">BeyondCompare</a> product is, but for the sake of my wallet I’d rather use a tool that was free.&#160; Enter Perforce’s <a href="http://www.perforce.com/perforce/products/merge.html" target="_blank">P4Merge</a>.</p>  <p>The only hassle with using this tool is that it doesn’t integrate that easily into Visual Studio as a merrge tool – you can’t just call the executable and supply arguments, you have to work around it a little.&#160; Here’s how:</p>  <h4>As a Comparison Tool</h4>  <p>Setting P4Merge up as your comparison tool is simple enough.&#160; Go to Tools-&gt;Options and navigate to Source Control and Visual Studio Team Foundation Server.&#160; Select the Configure User Tools… option.</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/SrNKJVViWJI/AAAAAAAAAqk/lTUPn7zxg2Y/s1600-h/image%5B3%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/SrNKKZZFDSI/AAAAAAAAAqo/OZPQOlbKsWQ/image_thumb%5B1%5D.png?imgmax=800" width="504" height="294" /></a></p>  <p>Then choose Add and set the options as shown:</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/SrNKLDGFR_I/AAAAAAAAAqs/YorLmdvp5Fw/s1600-h/image%5B7%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_5dD_rBQSs2o/SrNKLz5G8cI/AAAAAAAAAqw/t9HFqAG5KrI/image_thumb%5B3%5D.png?imgmax=800" width="421" height="225" /></a> </p>  <p>Hit OK, and that one’s done.&#160; Note you may have to supply a different path to the P4Merge program if you installed it in a different location.</p>  <h4>Merge Tool</h4>  <p>For merging things get a little tricker because P4Merge wants the output file for the merge operation to exist before you actually do the merge.&#160; This is where the VS integration presents a small problem, since VS doesn’t create the result file before calling the tool.&#160; It expects the tool to create it instead.</p>  <p>To work around this we need to create a simple batch file that we will get Visual Studio to call.&#160; For the sake of sharing across multiple users on my machine, I’m placing the file in C:\Users\Public\Documents\p4merge.bat.</p>  <p>The contents of the file should be:</p>  <p>@ECHO OFF   <br />COPY /Y NUL %4    <br />START /WAIT /D &quot;C:\Program Files\Perforce&quot; p4merge.exe %1 %2 %3 %4</p>  <p>Once you’ve created that file, go through the same steps as above for Compare, but this time select the Merge operation and point to the batch file instead of the P4Merge program.&#160; The end result should be something like this:</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/SrNKMsR75II/AAAAAAAAAq0/HW4Qtvt2dDg/s1600-h/image%5B12%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_5dD_rBQSs2o/SrNKNbpPcuI/AAAAAAAAAq4/BF00QL6a_JQ/image_thumb%5B6%5D.png?imgmax=800" width="421" height="225" /></a> </p>  <p>Note that the arguments are passed in a non-standard order. It’s %3 %1 %2 %4</p>  <p>Once this is done, get out of the options and try it out.&#160; Here’s the tool in action</p>  <p>Comparison:</p>  <p><a href="http://lh5.ggpht.com/_5dD_rBQSs2o/SrNKOdPE9ZI/AAAAAAAAAq8/1o7JNdbz8mg/s1600-h/image%5B16%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/SrNKPae1TMI/AAAAAAAAArA/IFrTleUkkyo/image_thumb%5B8%5D.png?imgmax=800" width="504" height="252" /></a> </p>  <p></p>  <p></p>  <p></p>  <p></p>  <p>Merging:</p>  <p><a href="http://lh3.ggpht.com/_5dD_rBQSs2o/SrNKQOM3DwI/AAAAAAAAArE/r0aS1XLNt9Y/s1600-h/image%5B20%5D.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_5dD_rBQSs2o/SrNKRaopa4I/AAAAAAAAArI/vewNEzqYnfo/image_thumb%5B10%5D.png?imgmax=800" width="504" height="406" /></a> </p>  <p>Enjoy!</p>  