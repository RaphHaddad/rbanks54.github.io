---
layout: post
title: Improved Unit Testing with Visual Studio 11 Beta
date: '2012-03-03T19:59:00.001+11:00'
author: Richard Banks
tags:
- Visual Studio
- alm
- tools
- development
modified_time: '2012-03-03T20:56:05.582+11:00'
thumbnail: http://lh6.ggpht.com/-ahAO0fAOiF0/T1HdTD44N6I/AAAAAAAABQA/5ulG-49fNIM/s72-c/image_thumb%25255B5%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-13321238.post-1925976331626602003
blogger_orig_url: http://www.richard-banks.org/2012/03/get-visual-studio-11-beta-right-now-for.html
---

<a href="http://lh4.ggpht.com/-kKV7ACyilLA/T1HdSm74Z3I/AAAAAAAABP4/b6Jvt8_IYM8/s1600-h/image%25255B11%25255D.png"><img align="left" alt="image" border="0" height="240" src="http://lh6.ggpht.com/-ahAO0fAOiF0/T1HdTD44N6I/AAAAAAAABQA/5ulG-49fNIM/image_thumb%25255B5%25255D.png?imgmax=800" style="background-image: none; border: 0px currentColor; display: inline; float: left; margin: 0px 10px 10px 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="212" /></a>There’s just so much new stuff in the Visual Studio 11 Beta! In fact, someone should write a book about it… Oh wait, I am! (more on that when the time is right). For now, let’s have a look at one feature that makes me so very happy: Visual Studio’s new and improved unit testing capabilities.<br />It’s widely recognised by those with a desire to do unit testing that there are better unit test frameworks out there than MSTest but given that Visual Studio has always been so tightly coupled with MSTest it’s always been more difficult than it should be to get other test frameworks working well in Visual Studio.&nbsp; The TestDriven.NET and ReSharper test runners have helped, but the integration back to visual studio was always lacking.<br />That all changes with the Visual Studio 11. Now it’s a case of “Use the framework that makes you happy. We don’t mind”.<br />You want to use XUnit? No problem!    <br />NUnit? Easy!    <br />MSTest (without the baggage it usually has)? Sure thing!    <br />QUnit for JavaScript? Bring it on!    <br />Something random that we’ve never heard of? Write an adapter and it’ll work just fine!<br /><h3> Dogs and Cats Living Together!</h3>Visual Studio 11 introduced a test adapter model so that any test framework can run inside Visual Studio if there is an adapter for it.&nbsp; The adapter model also means that you can not only run XUnit, NUnit, or any other type of test but you can run them in the same test assembly if you really wanted to! Why? I don’t know! But you can :-)<br />Maybe you have a suite of MSTest tests but you also want use XUnit’s data driven test features because <a href="http://www.richard-banks.org/2010/03/mstest-sucks-for-unit-tests.html" target="_blank">MSTest sucks for unit testing</a>. You can do just that.&nbsp; It’s really nice.<br />Note: In MSTest’s favour, in this release when MSTest is used in a plain old class library for unit testing the MSTest test adapter uses a cut down, light weight version of MSTest with just the features needed for unit testing and none of the baggage that it normally comes with, making it quite usable for most unit testing needs. For most developers with an existing investment in MSTest tests they will see an improvement in performance as a result.<br /><h3> Pre-Requisites</h3>Get yourself started by loading the appropriate adapter for your unit test framework from the Visual Studio Extension Manager.&nbsp; MSTest is already in the box so you don’t have to worry about that one.&nbsp; In this screen shot I’ve loaded up the <a href="http://xunit.codeplex.com/" target="_blank">XUnit</a>, <a href="http://www.nunit.org/" target="_blank">NUnit</a> and <a href="http://chutzpah.codeplex.com/" target="_blank">Chutzpah</a> test adapters.<br /><a href="http://lh5.ggpht.com/-37SwZw6hBwc/T1HdTX5Kh3I/AAAAAAAABQI/Mn_31u3A8AA/s1600-h/SNAGHTML5b8384c%25255B6%25255D.png"><img alt="SNAGHTML5b8384c" border="0" height="442" src="http://lh3.ggpht.com/-feyQmQYP2ss/T1HdT-Tu97I/AAAAAAAABQQ/KM3b2tWdVWo/SNAGHTML5b8384c_thumb%25255B3%25255D.png?imgmax=800" style="background-image: none; border: 0px currentColor; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="SNAGHTML5b8384c" width="640" /></a><br /><h2> Running Unit Tests</h2>Create a new C# Assembly project (NOT a test project) and add the XUnit and NUnit test frameworks to your project using NuGet<br /><a href="http://lh4.ggpht.com/-CkDaKMxqJhY/T1HdUfiB1eI/AAAAAAAABQY/fePx1sFDo8Q/s1600-h/SNAGHTML5c26ddd%25255B5%25255D.png"><img alt="SNAGHTML5c26ddd" border="0" height="427" src="http://lh3.ggpht.com/-hck3xCardUY/T1HdVMYFVWI/AAAAAAAABQg/e8z-hz8VQZQ/SNAGHTML5c26ddd_thumb%25255B2%25255D.png?imgmax=800" style="background-image: none; border: 0px currentColor; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="SNAGHTML5c26ddd" width="640" /></a><br />You can also add a reference to Microsoft.VisualStudio.QualityTools.UnitTestFramework so that you can do MSTest based unit tests.<br />Here, I’ve started by adding a simple XUnit test, then building the code and running the unit test as shown:<br /><a href="http://lh5.ggpht.com/-2io0-1hoCjQ/T1HdVhVdNGI/AAAAAAAABQo/5N6foa6e2gY/s1600-h/SNAGHTML5d08bb9%25255B6%25255D.png"><img alt="SNAGHTML5d08bb9" border="0" height="480" src="http://lh4.ggpht.com/-fJFzFgU678A/T1HdWDkyiHI/AAAAAAAABQw/hP7U_5VbHWg/SNAGHTML5d08bb9_thumb%25255B3%25255D.png?imgmax=800" style="background-image: none; border: 0px currentColor; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="SNAGHTML5d08bb9" width="589" /></a><br />As you can see in the output window there is now a “Discover test started” phase where Visual Studio looks at the assemblies and determines what tests are in the system so that it can spin up the right framework and execute the tests.<br />The Unit Test explorer on the left shows the tests that were run, the time it took and any error information for failed tests.<br />In the same code I have then added MSTest and NUnit tests as shown, however at this stage I have not yet built the project – take note of the unsaved changes icon in the document tab, indicating that the project is neither saved nor built as yet:<br /><a href="http://lh4.ggpht.com/-zX9vPpCtZsg/T1HdWzezY3I/AAAAAAAABQ4/VZLr6pZnINw/s1600-h/image%25255B10%25255D.png"><img alt="image" border="0" height="449" src="http://lh4.ggpht.com/-OCx9XEpV_vU/T1HdXlY80EI/AAAAAAAABRA/YaJXkSBumdQ/image_thumb%25255B4%25255D.png?imgmax=800" style="background-image: none; border: 0px currentColor; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="640" /></a><br /><h3> Run Tests After Build (Almost Continuous Testing)</h3>Continuous Testing is the idea that as you do your work all the unit tests are constantly running in the background and giving you live feedback when there are problems code by highlighting where tests have failed and where your code is broken.&nbsp; The immediate feedback cycle makes test driven development an even faster development process since there’s no waiting around for all the tests to run.<br />Visual Studio has taken a step towards this ideal with the “Run Tests After Build” option as shown in the image below. Turn that setting on and as soon as you compile your code Visual Studio will run the tests automatically on a background thread so that you don’t end up with a blocked UI and can get on with coding the next thing on your list.<br /><a href="http://lh3.ggpht.com/-pw0LrJJRHUg/T1HdYPodMVI/AAAAAAAABRI/KVJS9s7PuNc/s1600-h/image%25255B17%25255D.png"><img alt="image" border="0" height="175" src="http://lh4.ggpht.com/-97zRajE7lrE/T1HdYsOMN_I/AAAAAAAABRQ/Tnvhzsuz8W4/image_thumb%25255B9%25255D.png?imgmax=800" style="background-image: none; border: 0px currentColor; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="image" width="572" /></a><br />If a test failed the unit test explorer goes red and it’s obvious that there’s a problem.&nbsp; The interesting thing is that in smaller projects the tests often run so fast that you don’t even notice them happening!<br /><a href="http://lh6.ggpht.com/-CvYlh8abA4E/T1HdY1UF-4I/AAAAAAAABRY/2GdLSF5DD-o/s1600-h/SNAGHTML5de845a%25255B5%25255D.png"><img alt="SNAGHTML5de845a" border="0" height="467" src="http://lh4.ggpht.com/-wEJeHzcL9pk/T1HdZ6njg9I/AAAAAAAABRg/a7mQDZ_P2Vs/SNAGHTML5de845a_thumb%25255B2%25255D.png?imgmax=800" style="background-image: none; border: 0px currentColor; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="SNAGHTML5de845a" width="640" /></a><br />As a tip, once you’ve been using the test after build feature for a while you will probably want to stop the Output window from popping up every time you build so that you don’t have to keep closing it.&nbsp; You can do this in the Visual Studio Options as shown<br /><a href="http://lh4.ggpht.com/-VHsOJRYEUYU/T1HdaDqGK3I/AAAAAAAABRo/EhDFojou2qY/s1600-h/SNAGHTML5e0d612%25255B5%25255D.png"><img alt="SNAGHTML5e0d612" border="0" height="372" src="http://lh3.ggpht.com/-mUK3WI_7u3g/T1HdauOXw7I/AAAAAAAABRw/N_tArTI0C5c/SNAGHTML5e0d612_thumb%25255B2%25255D.png?imgmax=800" style="background-image: none; border: 0px currentColor; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="SNAGHTML5e0d612" width="640" /></a><br /><h3> Don’t Forget JavaScript Unit Tests!</h3>OK, I won’t.&nbsp; Make sure you have the Chutzpah test adapter Visual Studio extension installed (see above).<br />In a standard web project include QUnit or Jasmine in your project and then create a JavaScript file for your tests.&nbsp; Once you have your tests written run them as you normally would and Chutzpah will do the tricky work of finding the tests and running them.&nbsp; Here’s a screen shot of a web project with a QUnit test in it<br /><a href="http://lh4.ggpht.com/-qFUraQ23VYs/T1Hda96LxOI/AAAAAAAABR4/vp4ub10Lp6c/s1600-h/SNAGHTML6029dd3%25255B5%25255D.png"><img alt="SNAGHTML6029dd3" border="0" height="352" src="http://lh5.ggpht.com/-pNBDU03DgRc/T1HdbY1SKHI/AAAAAAAABSA/Hppyu4wv4v4/SNAGHTML6029dd3_thumb%25255B2%25255D.png?imgmax=800" style="background-image: none; border: 0px currentColor; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="SNAGHTML6029dd3" width="640" /></a><br /><h3> Conclusion</h3>So there you have it! A brief overview of the new unit testing features in Visual Studio 11 Beta. Go and get it now and start playing with it.<br />Having Visual Studio automatically running your tests each time you do a build will change your development workflow for the better and keep you more focused on coding and help you stay in the mythical zone if you ever get there.<br />Remember that since all tests run in the background and this removes the time spent waiting for tests to finish that you can have tens of thousands of tests taking minutes to run each time and you won’t even feel a delay in your development activities.&nbsp; Fantastic!