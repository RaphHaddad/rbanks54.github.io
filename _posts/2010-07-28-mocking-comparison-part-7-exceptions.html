---
layout: post
title: 'Mocking Comparison – Part 7: Exceptions'
date: '2010-07-28T11:25:00.001+10:00'
author: Richard Banks
tags:
- mocking
modified_time: '2010-08-06T08:56:01.238+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-8214043446228931345
blogger_orig_url: http://www.richard-banks.org/2010/07/mocking-comparison-part-7-exceptions.html
---

<p>One of the great benefits of using mocks in your tests is being able to check how your classes behave when exceptions are thrown.&#160; You do test for this sort of thing, right? :-)</p>  <p>Let’s say we have a persistence mechanism that talks to SQL.&#160; What happens when we get a SQL primary key violation?&#160; What if we are talking to web services and the connection drops or we get some other WCF exception?&#160; How do we handle that?</p>  <p>More importantly, how do we get Rhino Mocks, Moq or NSubstitute to raise those exceptions.&#160; Let’s have a look.</p>  <h3>Rhino Mocks</h3>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:ffa92971-2ae7-4dfd-821c-de45d7bd5028" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Rhino_throwing_exceptions()<br />{<br /> var monkey = MockRepository.GenerateMock&lt;IMonkey&gt;();<br /> monkey.Stub(m =&gt; m.Name).Throw(new ApplicationException());<br /> Assert.Throws&lt;ApplicationException&gt;(() =&gt; monkey.Name);<br />}</pre></div><p>This is pretty simple code.&#160; Instead of returning a value, just throw an exception when the method is called.&#160; Too easy!</p><h3>Moq</h3><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:575ce605-2232-4483-a743-56b8fc04661a" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Moq_throwing_exceptions()<br />{<br /> var monkey = new Mock&lt;IMonkey&gt;();<br /> monkey.Setup(m =&gt; m.Name).Throws(new ApplicationException());<br /> Assert.Throws&lt;ApplicationException&gt;(() =&gt; monkey.Object.Name);<br />}<br /></pre></div><p>The Moq code is much the same as the Rhino code, except we still have that .Object. tax that annoys me so much.</p><h3>NSubstitute</h3><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:0eb64a94-4ff9-4f66-a5f5-6b954063f87b" class="wlWriterEditableSmartContent"><pre class="brush: c#;">[Fact]<br />public void Nsub_throwing_exceptions()<br />{<br /> var monkey = Substitute.For&lt;IMonkey&gt;();<br /> monkey.Name.Returns(args =&gt; { throw new ApplicationException(); });<br /> Assert.Throws&lt;ApplicationException&gt;(() =&gt; monkey.Name);<br />}<br /></pre></div><p>Not quite as clean as the other two frameworks here, though I’m sure the guys will rectify this soon enough.</p><p>&#160;</p><p>And the winner: Rhino Mocks. Even though Moq requires slightly less code than Rhino it’s .Object. distinctions will always annoy me.</p><p>&nbsp;</p><p>Other posts in this series:<ul><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-1-basics.html">1: The Basics</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-2-properties.html">2: Properties</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-3-interactions.html">3: Interactions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-4-parameter.html">4: Parameter Constraints</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-5-repetitions.html">5: Repetitions</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-6-multiple.html">6: Multiple Calls</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-8-recursive.html">8: Recursive Mocks</a></li><li><a href="http://www.richard-banks.org/2010/07/mocking-comparison-part-9-functions.html">9: Functions</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-10-events.html">10: Events</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-11-multiple.html">11: Multiple Interfaces</a></li><li><a href="http://www.richard-banks.org/2010/08/mocking-comparison-part-12-unmockables.html">12: The UnMockables</a></li></ul></p>