---
layout: post
title: SourceMonitor and CruiseControl - The Top 15
date: '2007-01-19T09:14:00.000+11:00'
author: Richard Banks
tags:
- tools
- CruiseControl.NET
- development
modified_time: '2007-06-22T11:43:52.379+10:00'
blogger_id: tag:blogger.com,1999:blog-13321238.post-1916752910640235607
blogger_orig_url: http://www.richard-banks.org/2007/01/sourcemonitor-and-cruisecontrol-top-15.html
---

As a follow up to yesterdays post on <a href="http://richardsbraindump.blogspot.com/2007/01/integrating-cruisecontrolnet.html">SourceMonitor and CruiseControl.NET integration</a>, <a href="http://www.ridgway.co.za/Default.aspx">Eden Ridgway</a> has done some really nice work and posted a few styles sheets to help you create a <a href="http://www.ridgway.co.za/archive/2006/11/28/usefulsourcemonitorreportsincruisecontrol.aspx">SourceMonitor Top 15 Summary</a> of worst methods so you can target your refactoring efforts.<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://ridgway.co.za/images/ridgway_co_za/SourceMonitorReportSmall.jpg"><img style="cursor: pointer;" src="http://ridgway.co.za/images/ridgway_co_za/SourceMonitorReportSmall.jpg" alt="" border="0" /></a><br /><br />Thing good thing is you don't have to use MSBuild as Eden indicates and the steps to get it working are really easy.<br /><br /><ul><li>First, get <a href="http://richardsbraindump.blogspot.com/2007/01/integrating-cruisecontrolnet.html">SourceMonitor and CCNet working together</a>.</li></ul><ul><li>Next, <a href="http://www.ridgway.co.za/archive/2006/11/28/usefulsourcemonitorreportsincruisecontrol.aspx">download the style sheets</a> from Edens site and make the webdashboard changes.</li></ul><ul><li>Then in your NAnt build script simply add a &lt;style /&gt; task after the &lt;exec /&gt; task for SourceMonitor as shown.</li></ul><pre>&lt;!-- Execute the commands --&gt;<br />&lt;exec program="${sourcemonitor.executable}" commandline="/C ${sourcemonitor.input}" failonerror="false" /&gt;<br />&lt;style style="SourceMonitorSummaryGeneration.xsl" in="sm_details.xml" out="sm_top15.xml" /&gt;<br />&lt;delete file="${codemetrics.output.dir}\sm_project.smp" failonerror="false" /&gt;</pre>The &lt;delete /&gt; task is to clean up the sourcemonitor project file.  The file grows over time so leaving it around on a busy build server is probably not a good idea and will just fill up space.<br /><br /><ul><li>Make sure you include the _sm_top15.xml file in your ccnet.config &lt;merge /&gt; task then build the project and you should see some numbers.<br /></li></ul>What if you don't want a top 15?  Maybe you want a top 30?  Just edit the SourceMonitorSummaryGeneration.xsl file, find the two lines that look like this<br /><pre>&lt;xsl:when test="position() &amp;lt; 16" /&gt;</pre>and change the value 16 to 31.<br /><br />Also, if you have nesting that goes to 9+ levels, then the summary won't show it.  To get this showing you need to change the data-type to "text" in the Nesting Metrics section as shown here:<br /><pre>&lt;xsl:sort select="metrics/metric[@id='M12']" order="descending" data-type="text" /&gt;</pre>Finally, you might want to change the labels in the dashboard.config and xsl\sourcemonitor.xsl files to reflect that you are showing a Top 30<br /><br /><span style="font-weight: bold;">Update:</span> Eden has since fixed the stylesheet errors and made it easier to customise the number of items to show.  Thanks mate!